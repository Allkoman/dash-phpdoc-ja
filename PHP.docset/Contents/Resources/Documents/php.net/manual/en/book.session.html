<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>セッション処理</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.msession-unlock.html">msession_unlock</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.session.html">はじめに</a></div>
 <div class="up"><a href="refs.basic.session.html">セッション関連</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="book.session" class="book">
 
 <h1 class="title">セッション処理</h1>
 

 
 
 

 







 

 








 









 








 







 









 







 








<ul class="chunklist chunklist_book"><li><a href="intro.session.html">はじめに</a></li><li><a href="session.setup.html">インストール/設定</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.requirements.html">要件</a></li><li><a href="session.installation.html">インストール手順</a></li><li><a href="session.configuration.html">実行時設定</a></li><li><a href="session.resources.html">リソース型</a></li></ul></li><li><a href="session.constants.html">定義済み定数</a></li><li><a href="session.examples.html">例</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="session.examples.basic.html">基本的な使用法</a></li><li><a href="session.idpassing.html">セッションIDの受渡し</a></li><li><a href="session.customhandler.html">カスタムセッションハンドラ</a></li></ul></li><li><a href="session.upload-progress.html">セッションのアップロード状況</a></li><li><a href="session.security.html">Sessions and Security</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="features.session.security.management.html">Session Management Basics</a></li><li><a href="session.security.ini.html">Securing Session INI Settings</a></li></ul></li><li><a href="ref.session.html">セッション関数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.session-abort.html">session_abort</a> &mdash; session 配列の変更を破棄してセッションを終了します</li><li><a href="function.session-cache-expire.html">session_cache_expire</a> &mdash; 現在のキャッシュの有効期限を返す</li><li><a href="function.session-cache-limiter.html">session_cache_limiter</a> &mdash; 現在のキャッシュリミッタを取得または設定する</li><li><a href="function.session-commit.html">session_commit</a> &mdash; session_write_close のエイリアス</li><li><a href="function.session-create-id.html">session_create_id</a> &mdash; Create new session id</li><li><a href="function.session-decode.html">session_decode</a> &mdash; セッションエンコードされた文字列からセッションデータをデコードする</li><li><a href="function.session-destroy.html">session_destroy</a> &mdash; セッションに登録されたデータを全て破棄する</li><li><a href="function.session-encode.html">session_encode</a> &mdash; 現在のセッションデータを、セッションエンコードされた文字列に変換する</li><li><a href="function.session-gc.html">session_gc</a> &mdash; Perform session data garbage collection</li><li><a href="function.session-get-cookie-params.html">session_get_cookie_params</a> &mdash; セッションクッキーのパラメータを得る</li><li><a href="function.session-id.html">session_id</a> &mdash; 現在のセッション ID を取得または設定する</li><li><a href="function.session-is-registered.html">session_is_registered</a> &mdash; 変数がセッションに登録されているかどうかを調べる</li><li><a href="function.session-module-name.html">session_module_name</a> &mdash; 現在のセッションモジュールを取得または設定する</li><li><a href="function.session-name.html">session_name</a> &mdash; 現在のセッション名を取得または設定する</li><li><a href="function.session-regenerate-id.html">session_regenerate_id</a> &mdash; 現在のセッションIDを新しく生成したものと置き換える</li><li><a href="function.session-register-shutdown.html">session_register_shutdown</a> &mdash; セッションのシャットダウン関数</li><li><a href="function.session-register.html">session_register</a> &mdash; 現在のセッションに1つ以上の変数を登録する</li><li><a href="function.session-reset.html">session_reset</a> &mdash; session 配列を元の値で再初期化します</li><li><a href="function.session-save-path.html">session_save_path</a> &mdash; 現在のセッションデータ保存パスを取得または設定する</li><li><a href="function.session-set-cookie-params.html">session_set_cookie_params</a> &mdash; セッションクッキーパラメータを設定する</li><li><a href="function.session-set-save-handler.html">session_set_save_handler</a> &mdash; ユーザー定義のセッション保存関数を設定する</li><li><a href="function.session-start.html">session_start</a> &mdash; 新しいセッションを開始、あるいは既存のセッションを再開する</li><li><a href="function.session-status.html">session_status</a> &mdash; 現在のセッションの状態を返す</li><li><a href="function.session-unregister.html">session_unregister</a> &mdash; 現在のセッションから変数の登録を削除する</li><li><a href="function.session-unset.html">session_unset</a> &mdash; 全てのセッション変数を開放する</li><li><a href="function.session-write-close.html">session_write_close</a> &mdash; セッションデータを書き込んでセッションを終了する</li></ul></li><li><a href="class.sessionhandler.html">SessionHandler</a> &mdash; SessionHandler クラス<ul class="chunklist chunklist_book chunklist_children"><li><a href="sessionhandler.close.html">SessionHandler::close</a> &mdash; セッションを閉じる</li><li><a href="sessionhandler.create-sid.html">SessionHandler::create_sid</a> &mdash; 新規セッション ID を返す</li><li><a href="sessionhandler.destroy.html">SessionHandler::destroy</a> &mdash; セッションを破棄する</li><li><a href="sessionhandler.gc.html">SessionHandler::gc</a> &mdash; 古いセッションを削除する</li><li><a href="sessionhandler.open.html">SessionHandler::open</a> &mdash; セッションを開始する</li><li><a href="sessionhandler.read.html">SessionHandler::read</a> &mdash; セッションのデータを読み込む</li><li><a href="sessionhandler.write.html">SessionHandler::write</a> &mdash; セッションのデータを書き込む</li></ul></li><li><a href="class.sessionhandlerinterface.html">SessionHandlerInterface</a> &mdash; SessionHandlerInterface クラス<ul class="chunklist chunklist_book chunklist_children"><li><a href="sessionhandlerinterface.close.html">SessionHandlerInterface::close</a> &mdash; セッションを閉じる</li><li><a href="sessionhandlerinterface.destroy.html">SessionHandlerInterface::destroy</a> &mdash; セッションを破棄する</li><li><a href="sessionhandlerinterface.gc.html">SessionHandlerInterface::gc</a> &mdash; 古いセッションを削除する</li><li><a href="sessionhandlerinterface.open.html">SessionHandlerInterface::open</a> &mdash; セッションを開始する</li><li><a href="sessionhandlerinterface.read.html">SessionHandlerInterface::read</a> &mdash; セッションのデータを読み込む</li><li><a href="sessionhandlerinterface.write.html">SessionHandlerInterface::write</a> &mdash; セッションのデータを書き込む</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="116217""></a>
  <div class="note">
   <strong class="user">bouvrette dot nicolas at gmail dot com</strong>
   <a href="#116217" class="date">24-Nov-2014 06:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Be careful if you are updating to PHP 5.6 since the the Sessions's Write behavior changed.&nbsp; It now only writes the session if you changed the data. So this means that if you rely on your session to update an activity time stamp on the server (to control session expiry) you will end up having issues. Here is a quick fix if you are implementing SessionHandlerInterface:<br />
<br />
&nbsp;&nbsp;&nbsp; public function close() {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; $this-&gt;write($this-&gt;id, serialize($_SESSION));<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return true;<br />
&nbsp;&nbsp;&nbsp; }<br />
<br />
Make sure you also use this:<br />
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; ini_set('session.serialize_handler', 'php_serialize'); // Force standard PHP functions handler for flexibility<br />
<br />
More details here:<br />
<br />
Request #17860 (Session write short circuit)<br />
https://bugs.php.net/bug.php?id=17860</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="90351""></a>
  <div class="note">
   <strong class="user">e dot mortoray at ecircle dot com</strong>
   <a href="#90351" class="date">17-Apr-2009 02:02</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a nuance we found with session timing out although the user is still active in the session.&nbsp; The problem has to do with never modifying the session variable.
<br />

<br />
The GC will clear the session data files based on their last modification time.&nbsp; Thus if you never modify the session, you simply read from it, then the GC will eventually clean up.
<br />

<br />
To prevent this you need to ensure that your session is modified within the GC delete time.&nbsp; You can accomplish this like below.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">if( !isset(</span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) || (</span><span class="default">time</span><span class="keyword">() - </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">]) &gt; </span><span class="default">60 </span><span class="keyword">)
<br />
&nbsp; </span><span class="default">$_SESSION</span><span class="keyword">[</span><span class="string">'last_access'</span><span class="keyword">] = </span><span class="default">time</span><span class="keyword">();
<br />
</span><span class="default">?&gt;
<br />
</span>
<br />
This will update the session every 60s to ensure that the modification date is altered.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.msession-unlock.html">msession_unlock</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.session.html">はじめに</a></div>
 <div class="up"><a href="refs.basic.session.html">セッション関連</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
