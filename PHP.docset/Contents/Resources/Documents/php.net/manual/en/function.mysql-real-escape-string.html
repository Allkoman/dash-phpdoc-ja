<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>SQL 文中で用いる文字列の特殊文字をエスケープする</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mysql-query.html">mysql_query</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysql-result.html">mysql_result</a></div>
 <div class="up"><a href="ref.mysql.html">MySQL 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.mysql-real-escape-string" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">mysql_real_escape_string</h1>
  <p class="verinfo">(PHP 4 &gt;= 4.3.0, PHP 5)</p><p class="refpurpose"><span class="refname">mysql_real_escape_string</span> &mdash; <span class="dc-title">SQL 文中で用いる文字列の特殊文字をエスケープする</span></p>

 </div>

 <div id="function.mysql-real-escape-string-refsynopsisdiv">
  <div class="warning"><strong class="warning">警告</strong>
   <p class="para">
この拡張モジュールは PHP 5.5.0 で非推奨になり、PHP 7.0.0 で削除されました。
<a href="book.mysqli.html" class="link">MySQLi</a> あるいは
<a href="ref.pdo-mysql.html" class="link">PDO_MySQL</a> を使うべきです。詳細な情報は
<a href="mysqlinfo.api.choosing.html" class="link">MySQL: API の選択</a> や
<a href="faq.databases.html#faq.databases.mysql.deprecated" class="link">それに関連する FAQ</a> を参照ください。
この関数の代替として、これらが使えます。</p>
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="mysqli.real-escape-string.html" class="function">mysqli_real_escape_string()</a></span></li>
    <li class="member"><span class="methodname"><a href="pdo.quote.html" class="methodname">PDO::quote()</a></span></li>
   </ul>
  </div>
 </div>

 <div class="refsect1 description" id="refsect1-function.mysql-real-escape-string-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>mysql_real_escape_string</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$unescaped_string</code></span>
   [, <span class="methodparam"><span class="type">resource</span> <code class="parameter">$link_identifier</code><span class="initializer"> = NULL</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   現在の接続の文字セットで <code class="parameter">unescaped_string</code>
   の特殊文字をエスケープし、 <span class="function"><a href="function.mysql-query.html" class="function">mysql_query()</a></span>
   で安全に利用できる形式に変換します。バイナリデータを挿入しようとしている場合、
   必ずこの関数を利用しなければなりません。
  </p>
  <p class="para">
   <span class="function"><strong>mysql_real_escape_string()</strong></span> は、MySQL のライブラリ関数
   mysql_real_escape_string をコールしています。
   これは以下の文字について先頭にバックスラッシュを付加します。
   <em>\x00</em>, <em>\n</em>,
   <em>\r</em>, <em>\</em>, <em>&#039;</em>,
   <em>&quot;</em> そして <em>\x1a</em>.
  </p>
  <p class="para">
   データの安全性を確保するため、MySQL へクエリを送信する場合には
   （わずかな例外を除いて）常にこの関数を用いなければなりません。
  </p>
  
  <div class="caution"><strong class="caution">警告</strong>
   <h1 class="title">セキュリティ: デフォルトの文字セット</h1>
   <p class="para">
    サーバーレベルで設定するなり API 関数
    <span class="function"><a href="function.mysql-set-charset.html" class="function">mysql_set_charset()</a></span> を使うなりして、
    文字セットを明示しておく必要があります。この文字セットが
    <span class="function"><strong>mysql_real_escape_string()</strong></span>
    に影響を及ぼします。詳細は
    <a href="mysqlinfo.concepts.charset.html" class="link">文字セットの概念</a>
    を参照ください。
   </p>
  </div>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.mysql-real-escape-string-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">unescaped_string</code></dt>

     <dd>

      <p class="para">
       エスケープされる文字列。
      </p>
     </dd>

    
    <dt>
<code class="parameter">
link_identifier</code></dt>
<dd>
<p class="para">MySQL 接続。
指定されない場合、<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> により直近にオープンされたリンクが
指定されたと仮定されます。そのようなリンクがない場合、引数を指定せずに
<span class="function"><a href="function.mysql-connect.html" class="function">mysql_connect()</a></span> がコールした時と同様にリンクを確立します。
リンクが見付からない、または、確立できない場合、
<strong><code>E_WARNING</code></strong> レベルのエラーが生成されます。</p></dd>


   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.mysql-real-escape-string-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   成功した場合にエスケープ後の文字列、失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-function.mysql-real-escape-string-errors">
  <h3 class="title">エラー / 例外</h3>
  <p class="para">
   MySQL 接続が存在しない状態でこの関数を実行すると、
   <strong><code>E_WARNING</code></strong> レベルのエラーが発生します。
   この関数は、MySQL 接続が確立した状態でのみ実行するようにしましょう。
  </p>
 </div>

 
 <div class="refsect1 examples" id="refsect1-function.mysql-real-escape-string-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-1992">
    <p><strong>例1 単純な <span class="function"><strong>mysql_real_escape_string()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;接続<br /></span><span style="color: #0000BB">$link&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_connect</span><span style="color: #007700">(</span><span style="color: #DD0000">'mysql_host'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_user'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'mysql_password'</span><span style="color: #007700">)<br />&nbsp;&nbsp;&nbsp;&nbsp;OR&nbsp;die(</span><span style="color: #0000BB">mysql_error</span><span style="color: #007700">());<br /><br /></span><span style="color: #FF8000">//&nbsp;クエリ<br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">sprintf</span><span style="color: #007700">(</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;user='%s'&nbsp;AND&nbsp;password='%s'"</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$user</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$password</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
  <p class="para">
   <div class="example" id="example-1993">
    <p><strong>例2 <span class="function"><strong>mysql_real_escape_string()</strong></span> には接続が必須であることを示す例</strong></p>
    <div class="example-contents"><p>
     この例では、MySQL 接続が存在しない状態でこの関数を実行したときにどうなるかを示します。
    </p></div>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;まだ&nbsp;MySQL&nbsp;に接続していません<br /><br /></span><span style="color: #0000BB">$lastname&nbsp;&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"O'Reilly"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$_lastname&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">mysql_real_escape_string</span><span style="color: #007700">(</span><span style="color: #0000BB">$lastname</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;actors&nbsp;WHERE&nbsp;last_name&nbsp;=&nbsp;'</span><span style="color: #0000BB">$_lastname</span><span style="color: #DD0000">'"</span><span style="color: #007700">;<br /><br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$_lastname</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">var_dump</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Warning: mysql_real_escape_string(): No such file or directory in /this/test/script.php on line 5
Warning: mysql_real_escape_string(): A link to the server could not be established in /this/test/script.php on line 5

bool(false)
string(41) &quot;SELECT * FROM actors WHERE last_name = &#039;&#039;&quot;
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-1994">
    <p><strong>例3 SQL インジェクション攻撃の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;$_POST['password']&nbsp;をチェックしなければ、このような例でユーザーに望みどおりの情報を取得されてしまう<br /></span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">'aidan'</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]&nbsp;=&nbsp;</span><span style="color: #DD0000">"'&nbsp;OR&nbsp;''='"</span><span style="color: #007700">;<br /><br /></span><span style="color: #FF8000">//&nbsp;データベース上のユーザーに一致するかどうかを調べる<br /></span><span style="color: #0000BB">$query&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"SELECT&nbsp;*&nbsp;FROM&nbsp;users&nbsp;WHERE&nbsp;user='</span><span style="color: #007700">{</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'username'</span><span style="color: #007700">]}</span><span style="color: #DD0000">'&nbsp;AND&nbsp;password='</span><span style="color: #007700">{</span><span style="color: #0000BB">$_POST</span><span style="color: #007700">[</span><span style="color: #DD0000">'password'</span><span style="color: #007700">]}</span><span style="color: #DD0000">'"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">mysql_query</span><span style="color: #007700">(</span><span style="color: #0000BB">$query</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;MySQL&nbsp;に送信されたクエリは、<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">$query</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

     <div class="example-contents"><p>
      MySQL に送信されたクエリは次のとおり:
     </p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
SELECT * FROM users WHERE user=&#039;aidan&#039; AND password=&#039;&#039; OR &#039;&#039;=&#039;&#039;
</pre></div>
    </div>
    <div class="example-contents"><p>
     これでは、パスワードを知らなくても誰でもログインできてしまいます。
    </p></div>
   </div>
  </p>
 </div>


 <div class="refsect1 notes" id="refsect1-function.mysql-real-escape-string-notes">
  <h3 class="title">注意</h3>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    <span class="function"><strong>mysql_real_escape_string()</strong></span> を利用する前に、MySQL
    接続が確立されている必要があります。もし存在しなければ、
    <strong><code>E_WARNING</code></strong> レベルのエラーが生成され、<strong><code>FALSE</code></strong>
    が返されます。<code class="parameter">link_identifier</code> が指定されなかった場合は、
    直近の MySQL 接続が用いられます。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> が有効な場合は、
    まず最初に <span class="function"><a href="function.stripslashes.html" class="function">stripslashes()</a></span> を適用します。そうしないと、
    すでにエスケープされているデータに対してさらにエスケープ処理を
    してしまうことになります。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    この関数を用いてデータをエスケープしなければ、クエリは
    <a href="security.database.sql-injection.html" class="link">SQL インジェクション攻撃</a>
    に対しての脆弱性を持ったものになります。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <span class="simpara">
    <span class="function"><strong>mysql_real_escape_string()</strong></span> は
    <em>%</em> や <em>_</em> をエスケープしません。
    MySQL では、これらの文字を <em>LIKE</em>, <em>GRANT</em>,
    または <em>REVOKE</em> とともに用いることで、
    ワイルドカードを表現します。
   </span>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.mysql-real-escape-string-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.mysql-set-charset.html" class="function" rel="rdfs-seeAlso">mysql_set_charset()</a> - クライアントの文字セットを設定する</span></li>
    <li class="member"><span class="function"><a href="function.mysql-client-encoding.html" class="function" rel="rdfs-seeAlso">mysql_client_encoding()</a> - 文字セット名を返す</span></li>
    <li class="member"><span class="function"><a href="function.addslashes.html" class="function" rel="rdfs-seeAlso">addslashes()</a> - 文字列をスラッシュでクォートする</span></li>
    <li class="member"><span class="function"><a href="function.stripslashes.html" class="function" rel="rdfs-seeAlso">stripslashes()</a> - クォートされた文字列のクォート部分を取り除く</span></li>
    <li class="member">The <a href="info.configuration.html#ini.magic-quotes-gpc" class="link">magic_quotes_gpc</a> ディレクティブ</li>
    <li class="member">The <a href="info.configuration.html#ini.magic-quotes-runtime" class="link">magic_quotes_runtime</a> ディレクティブ</li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="120914""></a>
  <div class="note">
   <strong class="user">jonnie</strong>
   <a href="#120914" class="date">31-Mar-2017 07:53</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
To Quote Sam at Numb Safari<br />
<br />
[ "No discussion of escaping is complete without telling everyone that you should basically never use external input to generate interpreted code. This goes for SQL statements, or anything you would call any sort of "eval" function on.<br />
<br />
So, instead of using this terribly broken function, use parametric prepared statements instead.<br />
<br />
Honestly, using user provided data to compose SQL statements should be considered professional negligence and you should be held accountable by your employer or client for not using parametric prepared statements." ]<br />
<br />
Sam is right........<br />
<br />
However I do not think it is sensible to stop all sanitising and simply pass the task on to parametric prepared statements.<br />
<br />
A particular developer working in a particular situation will always know more about valid input (specific to that context). <br />
<br />
If you ask a user to pass in a value you have already given them and you know that all such values start AB****** and the string should be of length 7 or 11 but never any other length then you have the basis of a good pre-sanitiser - different allowable lengths of a string might indicate legacy data.<br />
<br />
I would never want to simply pass the rubbish that a malicious user may have passed in through a form to the parametric prepared statements, I would always want to do my own sanity checks first and in some cases these may err on the side of caution and simply choose to abort the Database op completely. <br />
<br />
That way my DB does not get clogged up with unsafe statements made safe - it simply does not get clogged up which is better.<br />
<br />
Security in layers - sanitisation and validation should still be considered in every situation BEFORE using prepared statements.<br />
<br />
In addition as far as I can read into the official doc<br />
==============================================<br />
<br />
"Escaping and SQL injection<br />
<br />
Bound variables are sent to the server separately from the query and thus cannot interfere with it. The server uses these values directly at the point of execution, after the statement template is parsed. Bound parameters do not need to be escaped as they are never substituted into the query string directly"<br />
<br />
That suggests to me that danger is avoided in the internals by alternative handling not by nullification.<br />
<br />
This means that a large project with incomplete conversion to prepared statements, legacy code in different parts of an organisation or servers talking to one another could all pass on the bad news from an immune location or situation to one that is not immune.<br />
<br />
As long as the sanitisation is competently performed without incurring additional risks then personally I would stick with certain layers of sanitisation and then call the prepared statements.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110413""></a>
  <div class="note">
   <strong class="user">sam at numbsafari dot com</strong>
   <a href="#110413" class="date">20-Oct-2012 02:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
No discussion of escaping is complete without telling everyone that you should basically never use external input to generate interpreted code. This goes for SQL statements, or anything you would call any sort of "eval" function on.
<br />

<br />
So, instead of using this terribly broken function, use parametric prepared statements instead.
<br />

<br />
Honestly, using user provided data to compose SQL statements should be considered professional negligence and you should be held accountable by your employer or client for not using parametric prepared statements.
<br />

<br />
What does that mean?
<br />

<br />
It means instead of building a SQL statement like this:
<br />

<br />
"INSERT INTO X (A) VALUES(".$_POST["a"].")"
<br />

<br />
You should use mysqli's prepare() function (<a href="http://php.net/manual/en/mysqli.prepare.php" rel="nofollow" target="_blank">http://php.net/manual/en/mysqli.prepare.php</a>) to execute a statement that looks like this:
<br />

<br />
"INSERT INTO X (A) VALUES(?)"
<br />

<br />
NB: This doesn't mean you should never generate dynamic SQL statements. What it means is that you should never use user-provided data to generate those statements. Any user-provided data should be passed through as parameters to the statement after it has been prepared.
<br />

<br />
So, for example, if you are building up a little framework and want to do an insert to a table based on the request URI, it's in your best interest to not take the $_SERVER['REQUEST_URI'] value (or any part of it) and directly concatenate that with your query. Instead,&nbsp; you should parse out the portion of the $_SERVER['REQUEST_URI'] value that you want, and map that through some kind of function or associative array to a non-user provided value. If the mapping produces no value, you know that something is wrong with the user provided data.
<br />

<br />
Failing to follow this has been the cause of a number of SQL-injection problems in the Ruby On Rails framework, even though it uses parametric prepared statements. This is how GitHub was hacked at one point. So, no language is immune to this problem. That's why this is a general best practice and not something specific to PHP and why you should REALLY adopt it.
<br />

<br />
Also, you should still do some kind of validation of the data provided by users, even when using parametric prepared statements. This is because that user-provided data will often become part of some generated HTML, and you want to ensure that the user provided data isn't going to cause security problems in the browser.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108125""></a>
  <div class="note">
   <strong class="user">Walter Tross</strong>
   <a href="#108125" class="date">30-Mar-2012 11:20</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For further information:<br />
<a href="http://dev.mysql.com/doc/refman/5.5/en/mysql-real-escape-string.html" rel="nofollow" target="_blank">http://dev.mysql.com/doc/refman/5.5/en/mysql-real-escape-string.html</a><br />
(replace your MySQL version in the URL)</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101248""></a>
  <div class="note">
   <strong class="user">feedr</strong>
   <a href="#101248" class="date">05-Dec-2010 05:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Just a little function which mimics the original mysql_real_escape_string but which doesn't need an active mysql connection. Could be implemented as a static function in a database class. Hope it helps someone.
<br />

<br />
<span class="default">&lt;?php
<br />
</span><span class="keyword">function </span><span class="default">mysql_escape_mimic</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">is_array</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">))
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="default">__METHOD__</span><span class="keyword">, </span><span class="default">$inp</span><span class="keyword">);
<br />

<br />
&nbsp;&nbsp;&nbsp; if(!empty(</span><span class="default">$inp</span><span class="keyword">) &amp;&amp; </span><span class="default">is_string</span><span class="keyword">(</span><span class="default">$inp</span><span class="keyword">)) {
<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">str_replace</span><span class="keyword">(array(</span><span class="string">'\\'</span><span class="keyword">, </span><span class="string">"\0"</span><span class="keyword">, </span><span class="string">"\n"</span><span class="keyword">, </span><span class="string">"\r"</span><span class="keyword">, </span><span class="string">"'"</span><span class="keyword">, </span><span class="string">'"'</span><span class="keyword">, </span><span class="string">"\x1a"</span><span class="keyword">), array(</span><span class="string">'\\\\'</span><span class="keyword">, </span><span class="string">'\\0'</span><span class="keyword">, </span><span class="string">'\\n'</span><span class="keyword">, </span><span class="string">'\\r'</span><span class="keyword">, </span><span class="string">"\\'"</span><span class="keyword">, </span><span class="string">'\\"'</span><span class="keyword">, </span><span class="string">'\\Z'</span><span class="keyword">), </span><span class="default">$inp</span><span class="keyword">);
<br />
&nbsp;&nbsp;&nbsp; }
<br />

<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$inp</span><span class="keyword">;
<br />
}
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95915""></a>
  <div class="note">
   <strong class="user">presto dot dk at gmail dot com</strong>
   <a href="#95915" class="date">28-Jan-2010 04:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to make sure that the ID you're using to do a query is a number, use sprint() of (int) or intval(), but don't use mysql_real_escape_string.<br />
<br />
There is no difference between ISO-8859-1's number 10 and UTF-8's number 10.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="95009""></a>
  <div class="note">
   <strong class="user">strata_ranger at hotmail dot com</strong>
   <a href="#95009" class="date">08-Dec-2009 08:17</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There's an interesting quirk in the example #2 about SQL injection:&nbsp; AND takes priority over OR, so the injected query actually executes as WHERE (user='aidan' AND password='') OR ''='', so instead of returning a database record corresponding to an arbitrary username (in this case 'aidan'), it would actually return ALL database records.&nbsp; In no particular order.&nbsp; So an attacker might be able to log in as any account, but not necessarily with any control over which account it is.<br />
<br />
Of course a potential attacker could simply modify their parameters to target specific users of interest:<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="comment">// E.g. attacker's values<br />
</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'username'</span><span class="keyword">] = </span><span class="string">''</span><span class="keyword">;<br />
</span><span class="default">$_POST</span><span class="keyword">[</span><span class="string">'password'</span><span class="keyword">] = </span><span class="string">"' OR user = 'administrator' AND '' = '"</span><span class="keyword">;<br />
<br />
</span><span class="comment">// Malformed query<br />
</span><span class="default">$query </span><span class="keyword">= </span><span class="string">"SELECT * FROM users WHERE user='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">username</span><span class="keyword">]</span><span class="string">' AND password='</span><span class="default">$_POST</span><span class="keyword">[</span><span class="default">password</span><span class="keyword">]</span><span class="string">'"</span><span class="keyword">;<br />
<br />
echo </span><span class="default">$query</span><span class="keyword">;<br />
<br />
</span><span class="comment">// The query sent to MySQL would read:<br />
// SELECT * FROM users WHERE user='' AND password='' OR user='administrator' AND ''='';<br />
// which would allow anyone to gain access to the account named 'administrator'<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="92493""></a>
  <div class="note">
   <strong class="user">plgs at ozemail dot com dot au</strong>
   <a href="#92493" class="date">27-Jul-2009 10:05</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Don't forget that if you're using Mysqli (ie, the "improved" Mysql extension) then you need to use the corresponding mysqli function mysqli_real_escape_string().&nbsp; The parameter order is also different.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66836""></a>
  <div class="note">
   <strong class="user">nicolas</strong>
   <a href="#66836" class="date">30-May-2006 10:38</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that mysql_real_escape_string doesn't prepend backslashes to \x00, \n, \r, and and \x1a as mentionned in the documentation, but actually replaces the character with a MySQL acceptable representation for queries (e.g. \n is replaced with the '\n' litteral). (\, ', and " are escaped as documented) This doesn't change how you should use this function, but I think it's good to know.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.mysql-query.html">mysql_query</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mysql-result.html">mysql_result</a></div>
 <div class="up"><a href="ref.mysql.html">MySQL 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
