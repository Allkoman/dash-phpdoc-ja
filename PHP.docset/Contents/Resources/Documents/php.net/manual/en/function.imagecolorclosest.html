<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>指定した色に最も近い色のインデックスを取得する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecolorat.html">imagecolorat</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecolorclosestalpha.html">imagecolorclosestalpha</a></div>
 <div class="up"><a href="ref.image.html">GD および Image 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.imagecolorclosest" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">imagecolorclosest</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">imagecolorclosest</span> &mdash; <span class="dc-title">指定した色に最も近い色のインデックスを取得する</span></p>

 </div>
 <div class="refsect1 description" id="refsect1-function.imagecolorclosest-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">int</span> <span class="methodname"><strong>imagecolorclosest</strong></span>
    ( <span class="methodparam"><span class="type">resource</span> <code class="parameter">$image</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$red</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$green</code></span>
   , <span class="methodparam"><span class="type">int</span> <code class="parameter">$blue</code></span>
   )</div>

  <p class="para rdfs-comment">
   指定した <acronym title="Red-Green-Blue">RGB</acronym> 値に「近い」
   画像パレット中の色のインデックスを返します。
  </p>
  <p class="para">
   指定した色とパレット上の各色の「距離」は、
   <acronym title="Red-Green-Blue">RGB</acronym> 値が三次元空間上の点の座標を表すと考えて計算します。
  </p>
  <p class="para">画像をファイルから作成した場合は、画像内で使われている色だけを解決します。パレットにだけ存在する色は解決されません。</p>
 </div>

 <div class="refsect1 parameters" id="refsect1-function.imagecolorclosest-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    <dt>
<code class="parameter">
image</code></dt>
<dd>
<p class="para"><span class="function"><a href="function.imagecreatetruecolor.html" class="function">imagecreatetruecolor()</a></span>
のような画像作成関数が返す画像リソース。</p></dd>

    
     <dt>
<code class="parameter">red</code></dt>

     <dd>

      <p class="para">赤コンポーネントの値。</p>
     </dd>

    
    
     <dt>
<code class="parameter">green</code></dt>

     <dd>

      <p class="para">緑コンポーネントの値。</p>
     </dd>

    
    
     <dt>
<code class="parameter">blue</code></dt>

     <dd>

      <p class="para">青コンポーネントの値。</p>
     </dd>

    
   </dl>

   色のパラメータは、0 から 255 までの整数値か
   0x00 から 0xFF までの十六進値を指定します。
  </p>
 </div>

 <div class="refsect1 returnvalues" id="refsect1-function.imagecolorclosest-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   画像パレット内で、指定した色にいちばん近い色のインデックスを返します。
  </p>
 </div>

 <div class="refsect1 examples" id="refsect1-function.imagecolorclosest-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-3527">
    <p><strong>例1 画像内での色セットの検索</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;画像を作成し、パレット画像に変換します<br /></span><span style="color: #0000BB">$im&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecreatefrompng</span><span style="color: #007700">(</span><span style="color: #DD0000">'figures/imagecolorclosest.png'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">imagetruecolortopalette</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">false</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">255</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;探したい色&nbsp;(RGB)<br /></span><span style="color: #0000BB">$colors&nbsp;</span><span style="color: #007700">=&nbsp;array(<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">254</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">145</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">154</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">153</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">145</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">188</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">153</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">90</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">145</span><span style="color: #007700">),<br />&nbsp;&nbsp;&nbsp;&nbsp;array(</span><span style="color: #0000BB">255</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">137</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">92</span><span style="color: #007700">)<br />);<br /><br /></span><span style="color: #FF8000">//&nbsp;それぞれを検索し、パレット内でもっとも近い色を見つけます<br />//&nbsp;検索番号、検索した&nbsp;RGB、そして見つかった&nbsp;RGB&nbsp;を返します<br /></span><span style="color: #007700">foreach(</span><span style="color: #0000BB">$colors&nbsp;</span><span style="color: #007700">as&nbsp;</span><span style="color: #0000BB">$id&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">)<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorclosest</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">],&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">imagecolorsforindex</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$result&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #DD0000">"(</span><span style="color: #007700">{</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #DD0000">'red'</span><span style="color: #007700">]}</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #DD0000">'green'</span><span style="color: #007700">]}</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #007700">{</span><span style="color: #0000BB">$result</span><span style="color: #007700">[</span><span style="color: #DD0000">'blue'</span><span style="color: #007700">]}</span><span style="color: #DD0000">)"</span><span style="color: #007700">;<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;</span><span style="color: #DD0000">"#</span><span style="color: #0000BB">$id</span><span style="color: #DD0000">:&nbsp;Search&nbsp;(</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">0</span><span style="color: #007700">]</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">1</span><span style="color: #007700">]</span><span style="color: #DD0000">,&nbsp;</span><span style="color: #0000BB">$rgb</span><span style="color: #007700">[</span><span style="color: #0000BB">2</span><span style="color: #007700">]</span><span style="color: #DD0000">);&nbsp;Closest&nbsp;match:&nbsp;</span><span style="color: #0000BB">$result</span><span style="color: #DD0000">.\n"</span><span style="color: #007700">;<br />}<br /><br /></span><span style="color: #0000BB">imagedestroy</span><span style="color: #007700">(</span><span style="color: #0000BB">$im</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
#0: Search (254, 145, 154); Closest match: (252, 150, 148).
#1: Search (153, 145, 188); Closest match: (148, 150, 196).
#2: Search (153, 90, 145); Closest match: (148, 90, 156).
#3: Search (255, 137, 92); Closest match: (252, 150, 92).
</pre></div>
    </div>
   </div>
  </p>
 </div>

 <div class="refsect1 seealso" id="refsect1-function.imagecolorclosest-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.imagecolorexact.html" class="function" rel="rdfs-seeAlso">imagecolorexact()</a> - 指定した色のインデックスを取得する</span></li>
    <li class="member"><span class="function"><a href="function.imagecolorclosestalpha.html" class="function" rel="rdfs-seeAlso">imagecolorclosestalpha()</a> - 指定した色+アルファ値に最も近い色のインデックスを取得する</span></li>
    <li class="member"><span class="function"><a href="function.imagecolorclosesthwb.html" class="function" rel="rdfs-seeAlso">imagecolorclosesthwb()</a> - 色合い、白、黒を有する色のインデックスを得る</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="121418""></a>
  <div class="note">
   <strong class="user">Hayley Watson</strong>
   <a href="#121418" class="date">23-Jul-2017 01:33</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
RGB space isn't the best choice for measuring the distance between two colours, since it ignores, for example, the fact that we count both dark green and light green as "green" (the RGB distance between #000000 and #7f7f7f is the same as the distance between #000000 and #5443c0 - a slightly darkened SlateBlue).<br />
<br />
A better choice of colour space that conforms better to how colours are perceived is the so-called Lab space, which measures colours according to how light/dark, red/green, and yellow/blue they are. (There are still better models, but they come at the expense of increased computation.)<br />
<br />
<span class="default">&lt;?php<br />
<br />
</span><span class="keyword">function </span><span class="default">warp1</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">10.3148</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">pow</span><span class="keyword">((</span><span class="default">561 </span><span class="keyword">+ </span><span class="default">40</span><span class="keyword">*</span><span class="default">$c</span><span class="keyword">)/</span><span class="default">10761</span><span class="keyword">, </span><span class="default">2.4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$c </span><span class="keyword">/ </span><span class="default">3294.6</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
function </span><span class="default">warp2</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$c </span><span class="keyword">&gt; </span><span class="default">0.008856</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">pow</span><span class="keyword">(</span><span class="default">$c</span><span class="keyword">, </span><span class="default">1</span><span class="keyword">/</span><span class="default">3</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; else<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">7.787 </span><span class="keyword">* </span><span class="default">$c </span><span class="keyword">+ </span><span class="default">4</span><span class="keyword">/</span><span class="default">29</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
function </span><span class="default">rgb2lab</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">$red</span><span class="keyword">, </span><span class="default">$green</span><span class="keyword">, </span><span class="default">$blue</span><span class="keyword">] = </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'warp1'</span><span class="keyword">, </span><span class="default">$rgb</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$x </span><span class="keyword">= </span><span class="default">warp2</span><span class="keyword">(</span><span class="default">$red </span><span class="keyword">* </span><span class="default">0.4339 </span><span class="keyword">+ </span><span class="default">$green </span><span class="keyword">* </span><span class="default">0.3762 </span><span class="keyword">+ </span><span class="default">$blue </span><span class="keyword">* </span><span class="default">0.1899</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$y </span><span class="keyword">= </span><span class="default">warp2</span><span class="keyword">(</span><span class="default">$red </span><span class="keyword">* </span><span class="default">0.2126 </span><span class="keyword">+ </span><span class="default">$green </span><span class="keyword">* </span><span class="default">0.7152 </span><span class="keyword">+ </span><span class="default">$blue </span><span class="keyword">* </span><span class="default">0.0722</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$z </span><span class="keyword">= </span><span class="default">warp2</span><span class="keyword">(</span><span class="default">$red </span><span class="keyword">* </span><span class="default">0.0178 </span><span class="keyword">+ </span><span class="default">$green </span><span class="keyword">* </span><span class="default">0.1098 </span><span class="keyword">+ </span><span class="default">$blue </span><span class="keyword">* </span><span class="default">0.8730</span><span class="keyword">);<br />
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$l </span><span class="keyword">= </span><span class="default">116</span><span class="keyword">*</span><span class="default">$y </span><span class="keyword">- </span><span class="default">16</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$a </span><span class="keyword">= </span><span class="default">500 </span><span class="keyword">* (</span><span class="default">$x </span><span class="keyword">- </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$b </span><span class="keyword">= </span><span class="default">200 </span><span class="keyword">* (</span><span class="default">$y </span><span class="keyword">- </span><span class="default">$z</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'intval'</span><span class="keyword">, [</span><span class="default">$l</span><span class="keyword">, </span><span class="default">$a</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">]);<br />
}<br />
<br />
function </span><span class="default">generate_palette_from_image</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$pal </span><span class="keyword">= [];<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$width </span><span class="keyword">= </span><span class="default">imagesx</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$height </span><span class="keyword">= </span><span class="default">imagesy</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; for(</span><span class="default">$x </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$x </span><span class="keyword">&lt; </span><span class="default">$width</span><span class="keyword">; ++</span><span class="default">$x</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; for(</span><span class="default">$y </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">; </span><span class="default">$y </span><span class="keyword">&lt; </span><span class="default">$height</span><span class="keyword">; ++</span><span class="default">$y</span><span class="keyword">)<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$pal</span><span class="keyword">[] = </span><span class="default">imagecolorat</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$x</span><span class="keyword">, </span><span class="default">$y</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_map</span><span class="keyword">(function(</span><span class="default">$col</span><span class="keyword">)use(</span><span class="default">$image</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$rgba </span><span class="keyword">= </span><span class="default">imagecolorsforindex</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">, </span><span class="default">$col</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return [</span><span class="default">$rgba</span><span class="keyword">[</span><span class="string">'red'</span><span class="keyword">], </span><span class="default">$rgba</span><span class="keyword">[</span><span class="string">'green'</span><span class="keyword">], </span><span class="default">$rgba</span><span class="keyword">[</span><span class="string">'blue'</span><span class="keyword">]];<br />
&nbsp;&nbsp;&nbsp; },&nbsp; &nbsp; </span><span class="default">array_unique</span><span class="keyword">(</span><span class="default">$pal</span><span class="keyword">));<br />
}<br />
<br />
function </span><span class="default">closest_rgb_in_palette</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">, </span><span class="default">$palette</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">// Quick return when the exact<br />
&nbsp;&nbsp;&nbsp; // colour is in the palette.<br />
&nbsp;&nbsp;&nbsp; </span><span class="keyword">if((</span><span class="default">$idx </span><span class="keyword">= </span><span class="default">array_search</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">, </span><span class="default">$palette</span><span class="keyword">)) !== </span><span class="default">false</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$idx</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; [</span><span class="default">$tl</span><span class="keyword">, </span><span class="default">$ta</span><span class="keyword">, </span><span class="default">$tb</span><span class="keyword">] = </span><span class="default">rgb2lab</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$dists </span><span class="keyword">= </span><span class="default">array_map</span><span class="keyword">(function(</span><span class="default">$plab</span><span class="keyword">)use(</span><span class="default">$tl</span><span class="keyword">, </span><span class="default">$ta</span><span class="keyword">, </span><span class="default">$tb</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; [</span><span class="default">$pl</span><span class="keyword">, </span><span class="default">$pa</span><span class="keyword">, </span><span class="default">$pb</span><span class="keyword">] = </span><span class="default">$plab</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$dl </span><span class="keyword">= </span><span class="default">$pl </span><span class="keyword">- </span><span class="default">$tl</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$da </span><span class="keyword">= </span><span class="default">$pa </span><span class="keyword">- </span><span class="default">$ta</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$db </span><span class="keyword">= </span><span class="default">$pa </span><span class="keyword">- </span><span class="default">$tb</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$dl </span><span class="keyword">* </span><span class="default">$dl </span><span class="keyword">+ </span><span class="default">$da </span><span class="keyword">* </span><span class="default">$da </span><span class="keyword">+ </span><span class="default">$db </span><span class="keyword">* </span><span class="default">$db</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; }, </span><span class="default">array_map</span><span class="keyword">(</span><span class="string">'rgb2lab'</span><span class="keyword">, </span><span class="default">$palette</span><span class="keyword">));<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">array_search</span><span class="keyword">(</span><span class="default">min</span><span class="keyword">(</span><span class="default">$dists</span><span class="keyword">), </span><span class="default">$dists</span><span class="keyword">);<br />
}<br />
<br />
function </span><span class="default">closest_rgb_in_image</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">, </span><span class="default">$image</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$palette </span><span class="keyword">= </span><span class="default">generate_palette_from_image</span><span class="keyword">(</span><span class="default">$image</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$palette</span><span class="keyword">[</span><span class="default">closest_rgb_in_palette</span><span class="keyword">(</span><span class="default">$rgb</span><span class="keyword">, </span><span class="default">$palette</span><span class="keyword">)];<br />
}<br />
<br />
</span><span class="default">$lena </span><span class="keyword">= </span><span class="default">imagecreatefrompng</span><span class="keyword">(</span><span class="string">'lena.png'</span><span class="keyword">);<br />
</span><span class="default">$red </span><span class="keyword">= </span><span class="default">closest_rgb_in_image</span><span class="keyword">([</span><span class="default">255</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">],</span><span class="default">$lena</span><span class="keyword">);<br />
echo </span><span class="default">join</span><span class="keyword">(</span><span class="string">' '</span><span class="keyword">, </span><span class="default">$red</span><span class="keyword">);&nbsp; </span><span class="comment">// 228 71 82<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
If you're going to be matching a lot of colours to a palette, you may want to precompute and reuse the Lab palette, instead of generating it fresh each time as done here.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="106433""></a>
  <div class="note">
   <strong class="user">info at codeworx dot ch</strong>
   <a href="#106433" class="date">09-Nov-2011 11:21</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Here is a function that compares two HEX colors for similarity. This can be useful if you want to detect colors that are not different enough to see for the naked eye. It returns a bool: TRUE if the colors are similar to each other (within tolerance) or FALSE if they are different enough.<br />
I tested a few colors and came up with a tolerance of 35 (rgb value - should be between 0 and 255) but you can change that tolerance by passing a third parameter to the function.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">compareColors </span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">$col2</span><span class="keyword">, </span><span class="default">$tolerance</span><span class="keyword">=</span><span class="default">35</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$col1Rgb </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"r" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"g" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"b" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col1</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$col2Rgb </span><span class="keyword">= array(<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"r" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col2</span><span class="keyword">, </span><span class="default">0</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"g" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">)),<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="string">"b" </span><span class="keyword">=&gt; </span><span class="default">hexdec</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$col2</span><span class="keyword">, </span><span class="default">4</span><span class="keyword">, </span><span class="default">2</span><span class="keyword">))<br />
&nbsp;&nbsp;&nbsp; );<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] &gt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] - </span><span class="default">$tolerance </span><span class="keyword">&amp;&amp; </span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] &lt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'r'</span><span class="keyword">] + </span><span class="default">$tolerance</span><span class="keyword">) &amp;&amp; (</span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] &gt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] - </span><span class="default">$tolerance </span><span class="keyword">&amp;&amp; </span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] &lt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'g'</span><span class="keyword">] + </span><span class="default">$tolerance</span><span class="keyword">) &amp;&amp; (</span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] &gt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] - </span><span class="default">$tolerance </span><span class="keyword">&amp;&amp; </span><span class="default">$col1Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] &lt;= </span><span class="default">$col2Rgb</span><span class="keyword">[</span><span class="string">'b'</span><span class="keyword">] + </span><span class="default">$tolerance</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="54254""></a>
  <div class="note">
   <strong class="user">MagicalTux at FF dot st</strong>
   <a href="#54254" class="date">28-Jun-2005 03:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A way to get each time an answer :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">imagegetcolor</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">imagecolorexact</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">) return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$c</span><span class="keyword">=</span><span class="default">imagecolorallocate</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$c</span><span class="keyword">!=-</span><span class="default">1</span><span class="keyword">) return </span><span class="default">$c</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">imagecolorclosest</span><span class="keyword">(</span><span class="default">$im</span><span class="keyword">, </span><span class="default">$r</span><span class="keyword">, </span><span class="default">$g</span><span class="keyword">, </span><span class="default">$b</span><span class="keyword">);<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
If the *exact* color is found in the image, it will be returned. If we don't have the exact color, we try to allocate it. If we can't allocate it, we return the closest color in the image.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="36489""></a>
  <div class="note">
   <strong class="user">Vikrant Korde &lt;vakorde at hotmail dot com&gt;</strong>
   <a href="#36489" class="date">11-Oct-2003 05:10</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
This functuion is useful when you are dealing with previously present images like .png, .jpg, etc. You can use this function for writing a text on the image.<br />
<br />
For me the function imagecolorallocate() was returning the -1 value. after lot of RnD and site search i found a function use of imagecolorclosest(). This solved my problem of writing the text on the image with customised color. <br />
<br />
Actually previously it was writing on the image but the color was not distinct. It was using the same color as of that background image. <br />
<br />
The following code segment was fine with me.<br />
<br />
header ("Content-type: image/jpeg"); <br />
$im = imagecreatefromjpeg("BlankButton.jpg");<br />
$white = imageColorClosest($im, 255,255,255);<br />
// this is for TTF fonts<br />
imagettftext ($im, 20, 0, 16, 30, $white, "/usr/X11R6/lib/X11/fonts/TTF/luximb.ttf", "Vikrant"); <br />
<br />
//this is for notmal font<br />
imagestring($im, 4, 0,0,"Korde", $white);<br />
imagejpeg($im,"",150); <br />
imagedestroy ($im);</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.imagecolorat.html">imagecolorat</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.imagecolorclosestalpha.html">imagecolorclosestalpha</a></div>
 <div class="up"><a href="ref.image.html">GD および Image 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
