<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>Geo IP ロケーション</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="refs.basic.other.html">その他の基本モジュール</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.geoip.html">はじめに</a></div>
 <div class="up"><a href="refs.basic.other.html">その他の基本モジュール</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="book.geoip" class="book">
 <h1 class="title">Geo IP ロケーション</h1>
 

 

 






 

 






 









<ul class="chunklist chunklist_book"><li><a href="intro.geoip.html">はじめに</a></li><li><a href="geoip.setup.html">インストール/設定</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="geoip.requirements.html">要件</a></li><li><a href="geoip.installation.html">インストール手順</a></li><li><a href="geoip.configuration.html">実行時設定</a></li><li><a href="geoip.resources.html">リソース型</a></li></ul></li><li><a href="geoip.constants.html">定義済み定数</a></li><li><a href="ref.geoip.html">GeoIP 関数</a><ul class="chunklist chunklist_book chunklist_children"><li><a href="function.geoip-asnum-by-name.html">geoip_asnum_by_name</a> &mdash; Get the Autonomous System Numbers (ASN)</li><li><a href="function.geoip-continent-code-by-name.html">geoip_continent_code_by_name</a> &mdash; 二文字の大陸コードを取得する</li><li><a href="function.geoip-country-code-by-name.html">geoip_country_code_by_name</a> &mdash; 二文字の国コードを取得する</li><li><a href="function.geoip-country-code3-by-name.html">geoip_country_code3_by_name</a> &mdash; 三文字の国コードを取得する</li><li><a href="function.geoip-country-name-by-name.html">geoip_country_name_by_name</a> &mdash; 完全な国名を取得する</li><li><a href="function.geoip-database-info.html">geoip_database_info</a> &mdash; GeoIP データベースの情報を取得する</li><li><a href="function.geoip-db-avail.html">geoip_db_avail</a> &mdash; GeoIP データベースが使用可能かどうかを調べる</li><li><a href="function.geoip-db-filename.html">geoip_db_filename</a> &mdash; 対応する GeoIP データベースのファイル名を返す</li><li><a href="function.geoip-db-get-all-info.html">geoip_db_get_all_info</a> &mdash; すべての GeoIP データベース形式についての詳細情報を返す</li><li><a href="function.geoip-domain-by-name.html">geoip_domain_by_name</a> &mdash; Get the second level domain name</li><li><a href="function.geoip-id-by-name.html">geoip_id_by_name</a> &mdash; インターネット接続方式を取得する</li><li><a href="function.geoip-isp-by-name.html">geoip_isp_by_name</a> &mdash; インターネットサービスプロバイダ (ISP) 名を取得する</li><li><a href="function.geoip-netspeedcell-by-name.html">geoip_netspeedcell_by_name</a> &mdash; Get the Internet connection speed</li><li><a href="function.geoip-org-by-name.html">geoip_org_by_name</a> &mdash; 組織名を取得する</li><li><a href="function.geoip-record-by-name.html">geoip_record_by_name</a> &mdash; GeoIP データベースで見つかった詳細な都市情報を返す</li><li><a href="function.geoip-region-by-name.html">geoip_region_by_name</a> &mdash; 国コードおよび地域を取得する</li><li><a href="function.geoip-region-name-by-code.html">geoip_region_name_by_code</a> &mdash; 国コードと地域コードから地域名を返す</li><li><a href="function.geoip-setup-custom-directory.html">geoip_setup_custom_directory</a> &mdash; Set a custom directory for the GeoIP database.</li><li><a href="function.geoip-time-zone-by-country-and-region.html">geoip_time_zone_by_country_and_region</a> &mdash; 国コードと地域コードからタイムゾーンを返す</li></ul></li></ul></div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="117240""></a>
  <div class="note">
   <strong class="user">istsehrgut</strong>
   <a href="#117240" class="date">08-May-2015 03:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you still want to use legacy binaries but also need IPv6 support this should help: <br />
<br />
In order to support IPv6-&gt;Country code easily and without unnecessary files based on the integration above:<br />
<br />
Grab a copy of the latest legacy IPv6 data (I'm assuming you already have IPv4 binary):<br />
<br />
wget <a href="http://geolite.maxmind.com/download/geoip/database/GeoIPv6.dat.gz" rel="nofollow" target="_blank">http://geolite.maxmind.com/download/geoip/database/GeoIPv6.dat.gz</a><br />
Decompress and move it to a dir accessible to your web server:<br />
<br />
gunzip GeoIPv6.dat<br />
mv GeoIPv6.dat /etc/usr/share/GeoIP/GeoIPv6.dat<br />
Grab a copy of geoip.inc from the Maxmind git dir (https://github.com/maxmind/geoip-api-php/blob/master/src/geoip.inc) and save it somewhere you can access wherever you'll need to run geoip.<br />
<br />
If you have php5-geoip installed as I did, remove it with sudo apt-get remove php5-geoip; purge as necessary.<br />
<br />
With the above done you can now test incoming IP address for v4 or v6 and get appropriate results.<br />
<br />
Example:<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">include_once(</span><span class="string">'geoip.inc'</span><span class="keyword">);<br />
<br />
</span><span class="comment">//set an IPv6 address for testing<br />
</span><span class="default">$ip</span><span class="keyword">=</span><span class="string">'2601:8:be00:cf20:ca60:ff:fe09:35b5'</span><span class="keyword">;<br />
<br />
</span><span class="comment">/*<br />
test if $ip is v4 or v6 and assign appropriate .dat file in $gi<br />
run appropriate function geoip_country_code_by_addr() vs geoip_country_code_by_addr_v6()&nbsp;&nbsp; <br />
*/<br />
</span><span class="keyword">if((</span><span class="default">strpos</span><span class="keyword">(</span><span class="default">$ip</span><span class="keyword">, </span><span class="string">":"</span><span class="keyword">) === </span><span class="default">false</span><span class="keyword">)) {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//ipv4<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gi </span><span class="keyword">= </span><span class="default">geoip_open</span><span class="keyword">(</span><span class="string">"/usr/share/GeoIP/GeoIP1.dat"</span><span class="keyword">,</span><span class="default">GEOIP_STANDARD</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$country </span><span class="keyword">= </span><span class="default">geoip_country_code_by_addr</span><span class="keyword">(</span><span class="default">$gi</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);<br />
}<br />
else {<br />
&nbsp;&nbsp;&nbsp; </span><span class="comment">//ipv6<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$gi </span><span class="keyword">= </span><span class="default">geoip_open</span><span class="keyword">(</span><span class="string">"/usr/share/GeoIP/GeoIPv6.dat"</span><span class="keyword">,</span><span class="default">GEOIP_STANDARD</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$country </span><span class="keyword">= </span><span class="default">geoip_country_code_by_addr_v6</span><span class="keyword">(</span><span class="default">$gi</span><span class="keyword">, </span><span class="default">$ip</span><span class="keyword">);<br />
}<br />
echo </span><span class="default">$ip </span><span class="keyword">. </span><span class="string">"&lt;br&gt;" </span><span class="keyword">. </span><span class="default">$country</span><span class="keyword">;<br />
</span><span class="default">This is specifically </span><span class="keyword">for </span><span class="default">Country</span><span class="keyword">, </span><span class="default">but can easily be replicated </span><span class="keyword">for </span><span class="default">City data</span><span class="keyword">.</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113992""></a>
  <div class="note">
   <strong class="user">mark at moderndeveloperllc dot com</strong>
   <a href="#113992" class="date">27-Dec-2013 02:43</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
It should be noted that this extension has now been superseded by the GeoIP2 API that MaxMind now produces. There is a pure-PHP set of classes and a C library and extension you can optionally install. The code can be found in various projects on MaxMind's GitHub page: https://github.com/maxmind/</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="refs.basic.other.html">その他の基本モジュール</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="intro.geoip.html">はじめに</a></div>
 <div class="up"><a href="refs.basic.other.html">その他の基本モジュール</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
