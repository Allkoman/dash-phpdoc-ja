<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>現在の Unix タイムスタンプをマイクロ秒まで返す</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.localtime.html">localtime</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mktime.html">mktime</a></div>
 <div class="up"><a href="ref.datetime.html">日付・時刻 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.microtime" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">microtime</h1>
  <p class="verinfo">(PHP 4, PHP 5, PHP 7)</p><p class="refpurpose"><span class="refname">microtime</span> &mdash; <span class="dc-title">
   現在の Unix タイムスタンプをマイクロ秒まで返す
  </span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.microtime-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type"><a href="language.pseudo-types.html#language.types.mixed" class="type mixed">mixed</a></span> <span class="methodname"><strong>microtime</strong></span>
    ([ <span class="methodparam"><span class="type">bool</span> <code class="parameter">$get_as_float</code><span class="initializer"> = false</span></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>microtime()</strong></span> は、現在の
   Unix タイムスタンプをマイクロ秒単位で返します。
   この関数は、gettimeofday() システムコールをサポートする
   オペレーティングシステムでのみ使用できます。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.microtime-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">get_as_float</code></dt>

     <dd>

      <p class="para">
       <strong><code>TRUE</code></strong> を指定すると、<span class="function"><strong>microtime()</strong></span> は文字列ではなく
       <span class="type"><a href="language.types.float.html" class="type float">float</a></span> を返すようになります。詳細は、返り値の説明を参照ください。
      </p>
     </dd>

    
   </dl>

  </p>
 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.microtime-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   デフォルトでは、<span class="function"><strong>microtime()</strong></span> は &quot;msec sec&quot;
   形式の文字列を返します。ただし、<em>sec</em> は Unix エポック (1970 年 1 月 1 日 0:00:00 GMT)
   からの経過秒数、<em>msec</em> は <em>sec</em>
   から経過したマイクロ秒数を秒単位で表したものです。
  </p>
  <p class="para">
   <code class="parameter">get_as_float</code> を
   <strong><code>TRUE</code></strong> に設定すると、<span class="function"><strong>microtime()</strong></span> は Unixエポック からの経過秒数を
   マイクロ秒で正確になるように <span class="type"><a href="language.types.float.html" class="type float">float</a></span> で表したものを返します。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.microtime-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-2586">
    <p><strong>例1 <span class="function"><strong>microtime()</strong></span> でタイマスクリプト実行</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;PHP&nbsp;5の動作を模擬する簡単な関数<br />&nbsp;*/<br /></span><span style="color: #007700">function&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">()<br />{<br />&nbsp;&nbsp;&nbsp;&nbsp;list(</span><span style="color: #0000BB">$usec</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$sec</span><span style="color: #007700">)&nbsp;=&nbsp;</span><span style="color: #0000BB">explode</span><span style="color: #007700">(</span><span style="color: #DD0000">"&nbsp;"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">());<br />&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;((float)</span><span style="color: #0000BB">$usec&nbsp;</span><span style="color: #007700">+&nbsp;(float)</span><span style="color: #0000BB">$sec</span><span style="color: #007700">);<br />}<br /><br /></span><span style="color: #0000BB">$time_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /><br /></span><span style="color: #FF8000">//&nbsp;しばらくスリープ<br /></span><span style="color: #0000BB">usleep</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime_float</span><span style="color: #007700">();<br /></span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$time_start</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Did&nbsp;nothing&nbsp;in&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #DD0000">&nbsp;seconds\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-2587">
    <p><strong>例2 PHP 5 におけるタイマスクリプト実行</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br />$time_start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /><br /></span><span style="color: #FF8000">//&nbsp;しばらくスリープ<br /></span><span style="color: #0000BB">usleep</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">);<br /><br /></span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">$time_end&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$time_start</span><span style="color: #007700">;<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Did&nbsp;nothing&nbsp;in&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #DD0000">&nbsp;seconds\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
   <div class="example" id="example-2588">
    <p><strong>例3 <span class="function"><strong>microtime()</strong></span> と <em>REQUEST_TIME_FLOAT</em> の例 (PHP 5.4.0 以降)</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;ランダムな時間のスリープ<br /></span><span style="color: #0000BB">usleep</span><span style="color: #007700">(</span><span style="color: #0000BB">mt_rand</span><span style="color: #007700">(</span><span style="color: #0000BB">100</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">10000</span><span style="color: #007700">));<br /><br /></span><span style="color: #FF8000">//&nbsp;PHP&nbsp;5.4.0&nbsp;以降は、REQUEST_TIME_FLOAT&nbsp;をスーパーグローバル&nbsp;$_SERVER&nbsp;から取得できるようになりました。<br />//&nbsp;ここにはリクエスト開始時のタイムスタンプがマイクロ秒の精度で記録されています。<br /></span><span style="color: #0000BB">$time&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">)&nbsp;-&nbsp;</span><span style="color: #0000BB">$_SERVER</span><span style="color: #007700">[</span><span style="color: #DD0000">"REQUEST_TIME_FLOAT"</span><span style="color: #007700">];<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Did&nbsp;nothing&nbsp;in&nbsp;</span><span style="color: #0000BB">$time</span><span style="color: #DD0000">&nbsp;seconds\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

   </div>
  </p>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.microtime-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.time.html" class="function" rel="rdfs-seeAlso">time()</a> - 現在の Unix タイムスタンプを返す</span></li>
   </ul>
  </p>
 </div>

</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="121536""></a>
  <div class="note">
   <strong class="user">how to set nonce value with microtime</strong>
   <a href="#121536" class="date">18-Aug-2017 07:50</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Using microtime() to set 'nonce' value:<br />
<br />
ini_set("precision", 16);<br />
$nonce="nonce=".microtime(true)/0.000001;</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113078""></a>
  <div class="note">
   <strong class="user">Daniel Rhodes</strong>
   <a href="#113078" class="date">27-Aug-2013 09:54</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
But note that the default 'precision' setting of PHP* - which is used when a float is converted to a stringy format by echo()ing, casting or json_encode()ing etc - is not enough to hold the six digit accuracy of microtime(true).<br />
<br />
Out of the box, microtime(true) will echo something like:<br />
<br />
1377611450.1234<br />
<br />
Which is obviously less than microsecond accuracy. You'll probably want to bump the 'precision' setting up to 16 which will echo something like:<br />
<br />
1377611450.123456<br />
<br />
*Internally* it will be accurate to the six digits even with the default 'precision', but a lot of things (ie. NoSQL databases) are moving to all-text representations these days so it becomes a bit more important.<br />
<br />
* 14 at the time of writing</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112725""></a>
  <div class="note">
   <strong class="user">Nads</strong>
   <a href="#112725" class="date">17-Jul-2013 05:28</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Get date time with milliseconds<br />
<br />
$micro_date = microtime();<br />
$date_array = explode(" ",$micro_date);<br />
$date = date("Y-m-d H:i:s",$date_array[1]);<br />
echo "Date: $date:" . $date_array[0];<br />
<br />
Test accuracy by running it in a loop.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="112104""></a>
  <div class="note">
   <strong class="user">Russell G.</strong>
   <a href="#112104" class="date">04-May-2013 05:34</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that the timestamp returned is "with microseconds", not "in microseconds". This is especially good to know if you pass 'true' as the parameter and then calculate the difference between two float values -- the result is already in seconds; it doesn't need to be divided by a million.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111107""></a>
  <div class="note">
   <strong class="user">player27</strong>
   <a href="#111107" class="date">16-Jan-2013 01:31</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can use one variable to check execution $time as follow:
<br />

<br />
<span class="default">&lt;?php
<br />
$time </span><span class="keyword">= -</span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="default">0</span><span class="keyword">;
<br />
for (</span><span class="default">$i</span><span class="keyword">=</span><span class="default">0</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4000</span><span class="keyword">); ++</span><span class="default">$i</span><span class="keyword">) {
<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$hash </span><span class="keyword">^= </span><span class="default">md5</span><span class="keyword">(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">str_shuffle</span><span class="keyword">(</span><span class="string">"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"</span><span class="keyword">), </span><span class="default">0</span><span class="keyword">, </span><span class="default">rand</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">,</span><span class="default">10</span><span class="keyword">)));
<br />
}
<br />
</span><span class="default">$time </span><span class="keyword">+= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);
<br />
echo </span><span class="string">"Hash: </span><span class="default">$hash</span><span class="string"> iterations:</span><span class="default">$i</span><span class="string"> time: "</span><span class="keyword">,</span><span class="default">sprintf</span><span class="keyword">(</span><span class="string">'%f'</span><span class="keyword">, </span><span class="default">$time</span><span class="keyword">),</span><span class="default">PHP_EOL</span><span class="keyword">;
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="108255""></a>
  <div class="note">
   <strong class="user">thomas</strong>
   <a href="#108255" class="date">12-Apr-2012 11:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I have been getting negative values substracting a later microtime(true) call from an earlier microtime(true) call on Windows with PHP 5.3.8<br />
<br />
Produces negative values<br />
------------------------------<br />
for($i = 0; $i&lt;100; $i++) {<br />
&nbsp;&nbsp;&nbsp; $x =&nbsp; microtime(true);<br />
&nbsp;&nbsp;&nbsp; //short calculation<br />
&nbsp;&nbsp;&nbsp; $y = microtime(true);<br />
&nbsp;&nbsp;&nbsp; echo ($y-$x) . "\n"; // &lt;--- mostly negatives<br />
}<br />
<br />
Calling usleep(1) seems to work<br />
---------------------------------------<br />
for($i = 0; $i&lt;100; $i++) {<br />
&nbsp;&nbsp;&nbsp; $x =&nbsp; microtime(true);<br />
&nbsp;&nbsp;&nbsp; //short calculation<br />
&nbsp;&nbsp;&nbsp; usleep(1);<br />
&nbsp;&nbsp;&nbsp; $y = microtime(true);<br />
&nbsp;&nbsp;&nbsp; echo ($y-$x) . "\n"; // &lt;--- fixed now<br />
}</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="104053""></a>
  <div class="note">
   <strong class="user">langpavel at phpskelet dot org</strong>
   <a href="#104053" class="date">19-May-2011 10:46</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I use this for measure duration of script execution. This function should be defined (and of couse first call made) as soon as possible.<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* get execution time in seconds at current point of call in seconds<br />
&nbsp;* @return float Execution time at this point of call<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">get_execution_time</span><span class="keyword">()<br />
{<br />
&nbsp;&nbsp;&nbsp; static </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">null</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; if(</span><span class="default">$microtime_start </span><span class="keyword">=== </span><span class="default">null</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$microtime_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">0.0</span><span class="keyword">; <br />
&nbsp;&nbsp;&nbsp; }&nbsp; &nbsp; <br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">) - </span><span class="default">$microtime_start</span><span class="keyword">; <br />
}<br />
</span><span class="default">get_execution_time</span><span class="keyword">();<br />
<br />
</span><span class="default">?&gt;<br />
</span><br />
However it is true that result depends of gettimeofday() call. ([jamie at bishopston dot net] wrote this &amp; I can confirm)<br />
If system time change, result of this function can be unpredictable (much greater or less than zero).</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101628""></a>
  <div class="note">
   <strong class="user">jamie at bishopston dot net</strong>
   <a href="#101628" class="date">30-Dec-2010 09:55</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
All these timing scripts rely on microtime which relies on gettimebyday(2)<br />
<br />
This can be inaccurate on servers that run ntp to syncronise the servers<br />
time.<br />
<br />
For timing, you should really use clock_gettime(2) with the<br />
CLOCK_MONOTONIC flag set.<br />
<br />
This returns REAL WORLD time, not affected by intentional clock drift.<br />
<br />
This may seem a bit picky, but I recently saw a server that's clock was an<br />
hour out, and they'd set it to 'drift' to the correct time (clock is speeded<br />
up until it reaches the correct time)<br />
<br />
Those sorts of things can make a real impact.<br />
<br />
Any solutions, seeing as php doesn't have a hook into clock_gettime?<br />
<br />
More info here: <a href="http://tinyurl.com/28vxja9" rel="nofollow" target="_blank">http://tinyurl.com/28vxja9</a><br />
<br />
<a href="http://blog.habets.pp.se/2010/09/" rel="nofollow" target="_blank">http://blog.habets.pp.se/2010/09/</a><br />
gettimeofday-should-never-be-used-to-measure-time</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="101561""></a>
  <div class="note">
   <strong class="user">Robin Leffmann</strong>
   <a href="#101561" class="date">24-Dec-2010 09:07</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
While doing some experiments on using microtime()'s output for an entropy generator I found that its microsecond value was always quantified to the nearest hundreds (i.e. the number ends with 00), which affected the randomness of the entropy generator. This output pattern was consistent on three separate machines, running OpenBSD, Mac OS X and Windows.<br />
&nbsp;<br />
The solution was to instead use gettimeofday()'s output, as its usec value followed no quantifiable pattern on any of the three test platforms.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="91566""></a>
  <div class="note">
   <strong class="user">gomodo at free dot fr</strong>
   <a href="#91566" class="date">17-Jun-2009 12:32</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Need a mini benchmark ?<br />
Use microtime with this (very smart) benchmark function :<br />
<br />
mixed mini_bench_to(array timelist[, return_array=false])<br />
return a mini bench result<br />
<br />
-the timelist first key must be 'start'<br />
-default return a resume string, or array if return_array= true :<br />
'total_time' (ms) in first row<br />
details (purcent) in next row<br />
<br />
example :<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">unset(</span><span class="default">$t</span><span class="keyword">);&nbsp; &nbsp; </span><span class="comment">// if previous used<br />
<br />
//-- zone to bench<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">$tab_test</span><span class="keyword">=array(</span><span class="default">1</span><span class="keyword">,</span><span class="default">2</span><span class="keyword">,</span><span class="default">3</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">,</span><span class="default">5</span><span class="keyword">,</span><span class="default">6</span><span class="keyword">,</span><span class="default">7</span><span class="keyword">,</span><span class="default">8</span><span class="keyword">);<br />
</span><span class="default">$fact</span><span class="keyword">=</span><span class="default">1</span><span class="keyword">;<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'init_values'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
foreach (</span><span class="default">$tab_test </span><span class="keyword">as </span><span class="default">$key</span><span class="keyword">=&gt;</span><span class="default">$value</span><span class="keyword">)<br />
{<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$fact</span><span class="keyword">=</span><span class="default">$fact</span><span class="keyword">*</span><span class="default">$value</span><span class="keyword">;<br />
}<br />
</span><span class="default">$t</span><span class="keyword">[</span><span class="string">'loop_fact'</span><span class="keyword">] = </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="string">"fact = "</span><span class="keyword">.</span><span class="default">$fact</span><span class="keyword">.</span><span class="string">"\n"</span><span class="keyword">;<br />
</span><span class="comment">//-- END zone to bench<br />
<br />
</span><span class="keyword">echo </span><span class="string">"---- string result----\n"</span><span class="keyword">;<br />
</span><span class="default">$str_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">);<br />
echo </span><span class="default">$str_result_bench</span><span class="keyword">; </span><span class="comment">// string return<br />
</span><span class="keyword">echo </span><span class="string">"---- tab result----\n"</span><span class="keyword">;<br />
</span><span class="default">$tab_result_bench</span><span class="keyword">=</span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$t</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
echo </span><span class="default">var_export</span><span class="keyword">(</span><span class="default">$tab_result_bench</span><span class="keyword">,</span><span class="default">true</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span>this example return:<br />
<br />
---- string result----<br />
total time : 0.0141 ms<br />
start -&gt; init_values : 51.1 %<br />
init_values -&gt; loop_fact : 48.9 %<br />
---- tab result----<br />
array (<br />
&nbsp; 'total_time' =&gt; 0.0141,<br />
&nbsp; 'start -&gt; init_values' =&gt; 51.1,<br />
&nbsp; 'init_values -&gt; loop_fact' =&gt; 48.9,<br />
)<br />
<br />
The function to include :<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">mini_bench_to</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">, </span><span class="default">$arg_ra</span><span class="keyword">=</span><span class="default">false</span><span class="keyword">) <br />
&nbsp; {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$tttime</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">((</span><span class="default">end</span><span class="keyword">(</span><span class="default">$arg_t</span><span class="keyword">)-</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">])*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="string">'total_time'</span><span class="keyword">]=</span><span class="default">$tttime</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; else </span><span class="default">$aff</span><span class="keyword">=</span><span class="string">"total time : "</span><span class="keyword">.</span><span class="default">$tttime</span><span class="keyword">.</span><span class="string">"ms\n"</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="string">'start'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$arg_t</span><span class="keyword">[</span><span class="string">'start'</span><span class="keyword">];<br />
<br />
&nbsp;&nbsp;&nbsp; foreach (</span><span class="default">$arg_t </span><span class="keyword">as </span><span class="default">$cle</span><span class="keyword">=&gt;</span><span class="default">$val</span><span class="keyword">)<br />
&nbsp;&nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if(</span><span class="default">$cle</span><span class="keyword">!=</span><span class="string">'start'</span><span class="keyword">)&nbsp; &nbsp; <br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prcnt_t</span><span class="keyword">=</span><span class="default">round</span><span class="keyword">(((</span><span class="default">round</span><span class="keyword">((</span><span class="default">$val</span><span class="keyword">-</span><span class="default">$prv_val</span><span class="keyword">)*</span><span class="default">1000</span><span class="keyword">,</span><span class="default">4</span><span class="keyword">)/</span><span class="default">$tttime</span><span class="keyword">)*</span><span class="default">100</span><span class="keyword">),</span><span class="default">1</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) </span><span class="default">$ar_aff</span><span class="keyword">[</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">]=</span><span class="default">$prcnt_t</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$aff</span><span class="keyword">.=</span><span class="default">$prv_cle</span><span class="keyword">.</span><span class="string">' -&gt; '</span><span class="keyword">.</span><span class="default">$cle</span><span class="keyword">.</span><span class="string">' : '</span><span class="keyword">.</span><span class="default">$prcnt_t</span><span class="keyword">.</span><span class="string">" %\n"</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_val</span><span class="keyword">=</span><span class="default">$val</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$prv_cle</span><span class="keyword">=</span><span class="default">$cle</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; if (</span><span class="default">$arg_ra</span><span class="keyword">) return </span><span class="default">$ar_aff</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">$aff</span><span class="keyword">;<br />
&nbsp; }<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="83504""></a>
  <div class="note">
   <strong class="user">luke at lucanos dot com</strong>
   <a href="#83504" class="date">29-May-2008 01:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Rather than using the list() function, etc. I have found the following code to be a bit cleaner and simpler:<br />
<span class="default">&lt;?php<br />
$theTime </span><span class="keyword">= </span><span class="default">array_sum</span><span class="keyword">( </span><span class="default">explode</span><span class="keyword">( </span><span class="string">' ' </span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">() ) );<br />
echo </span><span class="default">$theTime</span><span class="keyword">;<br />
</span><span class="comment"># Displays "1212018372.3366"<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="66187""></a>
  <div class="note">
   <strong class="user">EdorFaus</strong>
   <a href="#66187" class="date">16-May-2006 09:47</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Of the methods I've seen here, and thought up myself, to convert microtime() output into a numerical value, the microtime_float() one shown in the documentation proper(using explode,list,float,+) is the slowest in terms of runtime.<br />
<br />
I implemented the various methods, ran each in a tight loop 1,000,000 times, and compared runtimes (and output). I did this 10 times to make sure there wasn't a problem of other things putting a load spike on the server. I'll admit I didn't take into account martijn at vanderlee dot com's comments on testing accuracy, but as I figured the looping code etc would be the same, and this was only meant as a relative comparison, it should not be necessary.<br />
<br />
The above method took on average 5.7151877 seconds, while a method using substr and simply adding strings with . took on average 3.0144226 seconds. rsalazar at innox dot com dot mx's method using preg_replace used on average 4.1819633 seconds. This shows that there are indeed differences, but for normal use noone is going to notice it.<br />
<br />
Note that the substr method mentioned isn't quite the one given anonymously below, but one I made based on it:<br />
<span class="default">&lt;?php<br />
$time</span><span class="keyword">=</span><span class="default">microtime</span><span class="keyword">();<br />
</span><span class="default">$timeval</span><span class="keyword">=</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">).</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$time</span><span class="keyword">,</span><span class="default">1</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">);<br />
</span><span class="default">?&gt;<br />
</span><br />
Also worth noting is that the microtime_float() method gets faster, and no less accurate, if the (float) conversions are taken out and the variables are simply added together.<br />
<br />
Any of the methods that used + or array_sum ended up rounding the result to 2 digits after the decimal point, while (most of) the ones using preg_replace or substr and . kept all the digits.<br />
<br />
For accurate timing, since floating-point arithmetic would lose precision, I stored microtime results as-is and calculated time difference with this function:<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">microtime_used</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">$after</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; return (</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">11</span><span class="keyword">))<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; +(</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$after</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">)-</span><span class="default">substr</span><span class="keyword">(</span><span class="default">$before</span><span class="keyword">,</span><span class="default">0</span><span class="keyword">,</span><span class="default">9</span><span class="keyword">));<br />
}<br />
</span><span class="default">?&gt;<br />
</span><br />
For further information, the script itself, etc, see <a href="http://edorfaus.xepher.net/div/convert-method-test.php" rel="nofollow" target="_blank">http://edorfaus.xepher.net/div/convert-method-test.php</a></span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="59052""></a>
  <div class="note">
   <strong class="user">radek at pinkbike com</strong>
   <a href="#59052" class="date">25-Nov-2005 05:48</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
A lot of the comments here suggest adding in the following way:&nbsp; (float)$usec + (float)$sec<br />
Make sure you have the float precision high enough as with the default precision of 12, you are only precise to the 0.01 seconds.&nbsp; <br />
Set this in you php.ini file.<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; precision&nbsp; &nbsp; =&nbsp; 16</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="53969""></a>
  <div class="note">
   <strong class="user">vladson at pc-labs dot info</strong>
   <a href="#53969" class="date">19-Jun-2005 12:49</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I like to use bcmath for it<br />
<span class="default">&lt;?php<br />
</span><span class="keyword">function </span><span class="default">micro_time</span><span class="keyword">() {<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$temp </span><span class="keyword">= </span><span class="default">explode</span><span class="keyword">(</span><span class="string">" "</span><span class="keyword">, </span><span class="default">microtime</span><span class="keyword">());<br />
&nbsp;&nbsp;&nbsp; return </span><span class="default">bcadd</span><span class="keyword">(</span><span class="default">$temp</span><span class="keyword">[</span><span class="default">0</span><span class="keyword">], </span><span class="default">$temp</span><span class="keyword">[</span><span class="default">1</span><span class="keyword">], </span><span class="default">6</span><span class="keyword">);<br />
}<br />
<br />
</span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
</span><span class="default">sleep</span><span class="keyword">(</span><span class="default">1</span><span class="keyword">);<br />
</span><span class="default">$time_stop </span><span class="keyword">= </span><span class="default">micro_time</span><span class="keyword">();<br />
<br />
</span><span class="default">$time_overall </span><span class="keyword">= </span><span class="default">bcsub</span><span class="keyword">(</span><span class="default">$time_stop</span><span class="keyword">, </span><span class="default">$time_start</span><span class="keyword">, </span><span class="default">6</span><span class="keyword">);<br />
echo </span><span class="string">"Execution time - </span><span class="default">$time_overall</span><span class="string"> Seconds"</span><span class="keyword">;<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.localtime.html">localtime</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.mktime.html">mktime</a></div>
 <div class="up"><a href="ref.datetime.html">日付・時刻 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
