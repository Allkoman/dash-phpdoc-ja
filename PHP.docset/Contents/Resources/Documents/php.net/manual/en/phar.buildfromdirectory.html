<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>ディレクトリ内のファイルから phar を作成する</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="phar.apiversion.html">Phar::apiVersion</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="phar.buildfromiterator.html">Phar::buildFromIterator</a></div>
 <div class="up"><a href="class.phar.html">Phar</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="phar.buildfromdirectory" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">Phar::buildFromDirectory</h1>
  <p class="verinfo">(PHP &gt;= 5.3.0, PECL phar &gt;= 2.0.0)</p><p class="refpurpose"><span class="refname">Phar::buildFromDirectory</span> &mdash; <span class="dc-title">ディレクトリ内のファイルから phar を作成する</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-phar.buildfromdirectory-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="modifier">public</span> <span class="type">array</span> <span class="methodname"><strong>Phar::buildFromDirectory</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$base_dir</code></span>
   [, <span class="methodparam"><span class="type">string</span> <code class="parameter">$regex</code></span>
  ] )</div>

  <blockquote class="note"><p><strong class="note">注意</strong>: <p class="para">
このメソッドは、<var class="filename">php.ini</var> の <em>phar.readonly</em>
が <em>0</em> でないと <a href="class.phar.html" class="classname">Phar</a>
オブジェクトで動作しません。それ以外の場合は
<a href="class.pharexception.html" class="classname">PharException</a> がスローされます。</p></p></blockquote>
  <p class="para">
   ディレクトリの中身をもとに phar アーカイブを作成します。
   オプションの 2 番目のパラメータで正規表現 (pcre)
   を指定すると、特定のファイルを除外することができます。
   正規表現にマッチするすべてのファイルがアーカイブに含められ、
   それ以外のファイルは除外されます。より詳細に制御するには
   <span class="function"><a href="phar.buildfromiterator.html" class="function">Phar::buildFromIterator()</a></span> を使用します。
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-phar.buildfromdirectory-parameters">
  <h3 class="title">パラメータ</h3>
  <p class="para">
   <dl>

    
     <dt>
<code class="parameter">base_dir</code></dt>

     <dd>

      <p class="para">
       アーカイブに追加するすべてのファイルを含むディレクトリへの
       フルパスあるいは相対パス。
      </p>
     </dd>

    
    
     <dt>
<code class="parameter">regex</code></dt>

     <dd>

      <p class="para">
       オプションで指定する pcre 正規表現。
       これを使用してファイル一覧をフィルタリングします。
       正規表現にマッチするファイルパスのみがアーカイブに追加されます。
      </p>
     </dd>

    
   </dl>

  </p>

 </div>

 <div class="refsect1 returnvalues" id="refsect1-phar.buildfromdirectory-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   <span class="function"><strong>Phar::buildFromDirectory()</strong></span>
   は、連想配列を返します。これは、
   ファイルの内部パスをファイルシステム上のフルパスを対応させたものです。
  </p>
 </div>


 <div class="refsect1 errors" id="refsect1-phar.buildfromdirectory-errors">
  <h3 class="title">エラー / 例外</h3>
  <p class="para">
   このメソッドは、内部ディレクトリイテレータのインスタンスの作成に失敗したときに
   <a href="class.badmethodcallexception.html" class="classname">BadMethodCallException</a> をスローします。
   また、phar アーカイブの保存時にエラーが発生した場合は
   <a href="class.pharexception.html" class="classname">PharException</a> をスローします。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-phar.buildfromdirectory-examples">
  <h3 class="title">例</h3>
  <div class="example" id="example-733">
    <p><strong>例1 <span class="function"><strong>Phar::buildFromDirectory()</strong></span> の例</strong></p>
  <div class="example-contents"><p>
   
  </p></div>
  <div class="example-contents"><p>
   <div class="example-contents">
    <div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">//&nbsp;"project.phar"&nbsp;というエイリアスで作成します<br /></span><span style="color: #0000BB">$phar&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Phar</span><span style="color: #007700">(</span><span style="color: #DD0000">'project.phar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'project.phar'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;project&nbsp;内のすべてのファイルを追加します<br /></span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">buildFromDirectory</span><span style="color: #007700">(</span><span style="color: #0000BB">dirname</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'/project'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setStub</span><span style="color: #007700">(</span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createDefaultStub</span><span style="color: #007700">(</span><span style="color: #DD0000">'cli/index.php'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'www/index.php'</span><span style="color: #007700">));<br /><br /></span><span style="color: #0000BB">$phar2&nbsp;</span><span style="color: #007700">=&nbsp;new&nbsp;</span><span style="color: #0000BB">Phar</span><span style="color: #007700">(</span><span style="color: #DD0000">'project2.phar'</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">0</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'project2.phar'</span><span style="color: #007700">);<br /></span><span style="color: #FF8000">//&nbsp;project&nbsp;内のファイルのうち、php&nbsp;ファイルだけを追加します<br /></span><span style="color: #0000BB">$phar2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">buildFromDirectory</span><span style="color: #007700">(</span><span style="color: #0000BB">dirname</span><span style="color: #007700">(</span><span style="color: #0000BB">__FILE__</span><span style="color: #007700">)&nbsp;.&nbsp;</span><span style="color: #DD0000">'/project'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'/\.php$/'</span><span style="color: #007700">);<br /></span><span style="color: #0000BB">$phar2</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">setStub</span><span style="color: #007700">(</span><span style="color: #0000BB">$phar</span><span style="color: #007700">-&gt;</span><span style="color: #0000BB">createDefaultStub</span><span style="color: #007700">(</span><span style="color: #DD0000">'cli/index.php'</span><span style="color: #007700">,&nbsp;</span><span style="color: #DD0000">'www/index.php'</span><span style="color: #007700">));<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
   </div>

  </p></div>
  </div>
 </div>


 <div class="refsect1 seealso" id="refsect1-phar.buildfromdirectory-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="phar.buildfromiterator.html" class="function" rel="rdfs-seeAlso">Phar::buildFromIterator()</a> - イテレータから phar アーカイブを作成する</span></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="121091""></a>
  <div class="note">
   <strong class="user">dalfarra at codref dot com</strong>
   <a href="#121091" class="date">17-May-2017 12:00</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
If you want to exclude a directory from the archive (but include all the other content), the regular expression must take into consideration the whole path of the file, not just the file or directory name relative to the source folder.<br />
<br />
As an example, if we want to exclude "nbproject" directory from the archive (and any occurrence of it):<br />
<br />
/tmp/myfolder<br />
&nbsp; /nbproject<br />
&nbsp; /something<br />
&nbsp; /something-else<br />
&nbsp;&nbsp;&nbsp; /nbproject<br />
&nbsp; /file1.php<br />
&nbsp; /file2.php<br />
<br />
the regex should be:<br />
<span class="default">&lt;?php<br />
&nbsp; $exclude </span><span class="keyword">= </span><span class="string">'/^(?!(.*nbproject))(.*)$/i'</span><span class="keyword">;&nbsp; </span><span class="comment">//ignoring the case<br />
</span><span class="default">?&gt;<br />
</span><br />
A more complete example:<br />
<span class="default">&lt;?php<br />
&nbsp;&nbsp;&nbsp; $archive_file </span><span class="keyword">= </span><span class="string">'myarchive.tar'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$folder_to_compress </span><span class="keyword">= </span><span class="string">'/tmp/myfolder'</span><span class="keyword">;<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$archive </span><span class="keyword">= new </span><span class="default">PharData</span><span class="keyword">(</span><span class="default">$archive_file</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$exclude </span><span class="keyword">= </span><span class="string">'/^(?!(.*nbproject))(.*)$/i'</span><span class="keyword">;&nbsp; <br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$archive</span><span class="keyword">-&gt;</span><span class="default">buildFromDirectory</span><span class="keyword">(</span><span class="default">$folder_to_compress</span><span class="keyword">,</span><span class="default">$exclude</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">$archive</span><span class="keyword">-&gt;</span><span class="default">compress</span><span class="keyword">(</span><span class="default">Phar</span><span class="keyword">::</span><span class="default">GZ</span><span class="keyword">);<br />
&nbsp;&nbsp;&nbsp; </span><span class="default">unlink</span><span class="keyword">(</span><span class="default">$archive_file</span><span class="keyword">); </span><span class="comment">// as we already obtained a tar.gz<br />
</span><span class="default">?&gt;<br />
</span><br />
the archive will contain:<br />
/<br />
&nbsp; /something<br />
&nbsp; /something-else<br />
&nbsp; /file1.php<br />
&nbsp; /file2.php</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="phar.apiversion.html">Phar::apiVersion</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="phar.buildfromiterator.html">Phar::buildFromIterator</a></div>
 <div class="up"><a href="class.phar.html">Phar</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
