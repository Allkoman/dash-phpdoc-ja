<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
 <head>
  <meta http-equiv="content-type" content="text/html; CHARSET=shift-jis">
  <title>パスワードハッシュを作る</title>
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <link media="all" rel="stylesheet" type="text/css" href="style.css"/>
 </head>
 <body class="docs"><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.password-get-info.html">password_get_info</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.password-needs-rehash.html">password_needs_rehash</a></div>
 <div class="up"><a href="ref.password.html">Password Hashing 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div><hr /><div id="function.password-hash" class="refentry">
 <div class="refnamediv">
  <h1 class="refname">password_hash</h1>
  <p class="verinfo">(PHP 5 &gt;= 5.5.0, PHP 7)</p><p class="refpurpose"><span class="refname">password_hash</span> &mdash; <span class="dc-title">パスワードハッシュを作る</span></p>

 </div>

 <div class="refsect1 description" id="refsect1-function.password-hash-description">
  <h3 class="title">説明</h3>
  <div class="methodsynopsis dc-description">
   <span class="type">string</span> <span class="methodname"><strong>password_hash</strong></span>
    ( <span class="methodparam"><span class="type">string</span> <code class="parameter">$password</code></span>
   , <span class="methodparam"><span class="type">integer</span> <code class="parameter">$algo</code></span>
   [, <span class="methodparam"><span class="type">array</span> <code class="parameter">$options</code></span>
  ] )</div>

  <p class="para rdfs-comment">
   <span class="function"><strong>password_hash()</strong></span> は、強力な一方向ハッシュアルゴリズムを使って
   新しいパスワードハッシュを作ります。
   <span class="function"><strong>password_hash()</strong></span> は <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> と互換性があるので、
   <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> が作ったパスワードハッシュは
   <span class="function"><strong>password_hash()</strong></span> でも使えます。
  </p>
  <p class="simpara">
   現在、これらのアルゴリズムに対応しています。
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <span class="simpara">
      <strong><code>PASSWORD_DEFAULT</code></strong> - bcrypt アルゴリズムを使います (PHP 5.5.0 の時点でのデフォルトです)。
      新しくてより強力なアルゴリズムが PHP に追加されれば、
      この定数もそれにあわせて変わっていきます。
      そのため、これを指定したときの結果の長さは、変わる可能性があります。
      したがって、結果をデータベースに格納するときにはカラム幅を
      60 文字以上にできるようなカラムを使うことをお勧めします
      (255 文字くらいが適切でしょう)。
     </span>
    </li>
    <li class="listitem">
     <span class="simpara">
      <strong><code>PASSWORD_BCRYPT</code></strong> - <strong><code>CRYPT_BLOWFISH</code></strong>
      アルゴリズムを使ってハッシュを作ります。これは標準の <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span>
      互換のハッシュで、識別子 &quot;$2y$&quot; を使った場合の結果を作ります。
      その結果は、常に 60 文字の文字列になります。失敗した場合に <strong><code>FALSE</code></strong> を返します。
     </span>
    </li>
   </ul>
  </p>
  <p class="simpara">
   サポートするオプション
  </p>
  <p class="para">
   <ul class="itemizedlist">
    <li class="listitem">
     <p class="para">
      <em>salt</em> - パスワードのハッシュに使うソルトを手動で設定します。
      これは、自動生成されたソルトを上書きすることに注意しましょう。
     </p>
     <p class="para">
      省略した場合は、パスワードをハッシュするたびに <span class="function"><strong>password_hash()</strong></span>
      がランダムなソルトを自動生成します。これは意図したとおりの操作モードです。
     </p>
     <div class="warning"><strong class="warning">警告</strong>
      <p class="para">
       このソルト・オプションは、PHP 7.0.0 で非推奨になりました。
       このオプションは指定せずに、デフォルトで生成されるソルトを使うことを推奨します。
      </p>
     </div>
    </li>
    <li class="listitem">
     <p class="para">
      <em>cost</em> - 利用するアルゴリズムのコストを表します。
      値の例については <span class="function"><a href="function.crypt.html" class="function">crypt()</a></span> のページを参照ください。
     </p>

     <p class="para">
      省略した場合のデフォルトは <em>10</em> です。この値でもかまいませんが、
      ハードウェアの性能が許すならもう少し高くすることもできます。
     </p>
    </li>
   </ul>
  </p>
 </div>


 <div class="refsect1 parameters" id="refsect1-function.password-hash-parameters">
  <h3 class="title">パラメータ</h3>
  <dl>

   
    <dt>
<code class="parameter">password</code></dt>

    <dd>

     <p class="para">
      ユーザーのパスワード。
     </p>
      <div class="caution"><strong class="caution">警告</strong>
       <p class="para">
        <strong><code>PASSWORD_BCRYPT</code></strong> をアルゴリズムに指定すると、
        <code class="parameter">password</code> が最大 72 文字までに切り詰められます。
       </p>
      </div>
    </dd>

   
   
    <dt>
<code class="parameter">algo</code></dt>

    <dd>

     <p class="para">
      パスワードのハッシュに使うアルゴリズムを表す
<a href="password.constants.html" class="link">パスワードアルゴリズム定数</a>。
     </p>
    </dd>

   
   
    <dt>
<code class="parameter">options</code></dt>

    <dd>

     <p class="para">
      オプションを含む連想配列。各アルゴリズムがサポートするオプションについては、
<a href="password.constants.html" class="link">パスワードアルゴリズム定数</a>
のページを参照ください。
     </p>
     <p class="para">
      省略した場合は、ランダムな salt を生成してデフォルトのコストを使います。
     </p>
    </dd>

   
  </dl>

 </div>


 <div class="refsect1 returnvalues" id="refsect1-function.password-hash-returnvalues">
  <h3 class="title">返り値</h3>
  <p class="para">
   ハッシュしたパスワードを返します。失敗した場合に <strong><code>FALSE</code></strong> を返します。
  </p>
  <p class="para">
   使ったアルゴリズムやコスト、そしてソフトもハッシュの一部として返されます。
   つまり、ハッシュを検証するために必要な情報は、すべてそこに含まれているということです。
   そのため、<span class="function"><a href="function.password-verify.html" class="function">password_verify()</a></span> でハッシュを検証するときに、
   ソルトやアルゴリズムの情報を別に保存する必要はありません。
  </p>
 </div>


 <div class="refsect1 examples" id="refsect1-function.password-hash-examples">
  <h3 class="title">例</h3>
  <p class="para">
   <div class="example" id="example-970">
    <p><strong>例1 <span class="function"><strong>password_hash()</strong></span> の例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;デフォルトのアルゴリズムを使ってパスワードをハッシュします。<br />&nbsp;*&nbsp;現時点でのデフォルトは&nbsp;BCRYPT&nbsp;で、その結果は&nbsp;60&nbsp;文字になります。<br />&nbsp;*<br />&nbsp;*&nbsp;デフォルトは、今後変わる可能性があることに注意しましょう。結果が<br />&nbsp;*&nbsp;60&nbsp;文字以上になっても対応できるようにしておきましょう&nbsp;(255&nbsp;あたりが適切です)<br />&nbsp;*/<br /></span><span style="color: #007700">echo&nbsp;</span><span style="color: #0000BB">password_hash</span><span style="color: #007700">(</span><span style="color: #DD0000">"rasmuslerdorf"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PASSWORD_DEFAULT</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
$2y$10$.vGA1O9wmRjrwAVXD98HNOgsNpDczlqm3Jq7KnEd1rVAGv3Fykk1a
</pre></div>
    </div>
   </div>
  </p> 
  <p class="para">
   <div class="example" id="example-971">
    <p><strong>例2 <span class="function"><strong>password_hash()</strong></span> で、コストを手動で設定する例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;この例では、BCRYPT&nbsp;のコストをデフォルトより上げて、12&nbsp;にします。<br />&nbsp;*&nbsp;また、アルゴリズムを&nbsp;BCRYPT&nbsp;に変えたことにも注目しましょう。結果は常に&nbsp;60&nbsp;文字になります。<br />&nbsp;*/<br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'cost'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">12</span><span style="color: #007700">,<br />];<br />echo&nbsp;</span><span style="color: #0000BB">password_hash</span><span style="color: #007700">(</span><span style="color: #DD0000">"rasmuslerdorf"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PASSWORD_BCRYPT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
$2y$12$QjSH496pcT5CEbzjD/vtVeH03tfHKFy36d4J0Ltp3lRtee9HDxY3K
</pre></div>
    </div>
   </div>
  </p>
  
  <p class="para">
   <div class="example" id="example-972">
    <p><strong>例3 <span class="function"><strong>password_hash()</strong></span> で、ソルトを手動で設定する例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;ここでは、ソルトをランダムに生成するようにしています。<br />&nbsp;*&nbsp;固定のソルトを使ったり、ランダムではない方法で作ったソルトを使ったりしてはいけません。<br />&nbsp;*<br />&nbsp;*&nbsp;利用例の大半にあわせて、password_hash&nbsp;にランダムなソルトを生成させます。<br />&nbsp;*/<br /></span><span style="color: #0000BB">$options&nbsp;</span><span style="color: #007700">=&nbsp;[<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'cost'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">11</span><span style="color: #007700">,<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #DD0000">'salt'&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">mcrypt_create_iv</span><span style="color: #007700">(</span><span style="color: #0000BB">22</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">MCRYPT_DEV_URANDOM</span><span style="color: #007700">),<br />];<br />echo&nbsp;</span><span style="color: #0000BB">password_hash</span><span style="color: #007700">(</span><span style="color: #DD0000">"rasmuslerdorf"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PASSWORD_BCRYPT</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">$options</span><span style="color: #007700">).</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
$2y$11$q5MkhSBtlsJcNEVsYh64a.aCluzHnGog7TQAKVmQwO9C8xb.t89F.
</pre></div>
    </div>
   </div>
  </p>
  <p class="para">
   <div class="example" id="example-973">
    <p><strong>例4 <span class="function"><strong>password_hash()</strong></span> で、適切なコストを探す例</strong></p>
    <div class="example-contents">
<div class="phpcode"><code><span style="color: #000000">
<span style="color: #0000BB">&lt;?php<br /></span><span style="color: #FF8000">/**<br />&nbsp;*&nbsp;このコードは、サーバーをベンチマークして、どの程度のコストに耐えられるかを判断します。<br />&nbsp;*&nbsp;サーバーに負荷をかけすぎない範囲で、できるだけ高めのコストを設定したいものです。<br />&nbsp;*&nbsp;基準として&nbsp;8&nbsp;から&nbsp;10&nbsp;程度からはじめ、サーバーが十分に高速なら、できるだけ上げていきましょう。<br />&nbsp;*&nbsp;以下のコードでは、ストレッチングの時間を&nbsp;50&nbsp;ミリ秒以内にすることを狙っています。<br />&nbsp;*&nbsp;対話形式のログインを扱う際の許容時間としては、このあたりが妥当なところでしょう。<br />&nbsp;*/<br /></span><span style="color: #0000BB">$timeTarget&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">0.05</span><span style="color: #007700">;&nbsp;</span><span style="color: #FF8000">//&nbsp;50&nbsp;ミリ秒<br /><br /></span><span style="color: #0000BB">$cost&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">8</span><span style="color: #007700">;<br />do&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$cost</span><span style="color: #007700">++;<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$start&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">password_hash</span><span style="color: #007700">(</span><span style="color: #DD0000">"test"</span><span style="color: #007700">,&nbsp;</span><span style="color: #0000BB">PASSWORD_BCRYPT</span><span style="color: #007700">,&nbsp;[</span><span style="color: #DD0000">"cost"&nbsp;</span><span style="color: #007700">=&gt;&nbsp;</span><span style="color: #0000BB">$cost</span><span style="color: #007700">]);<br />&nbsp;&nbsp;&nbsp;&nbsp;</span><span style="color: #0000BB">$end&nbsp;</span><span style="color: #007700">=&nbsp;</span><span style="color: #0000BB">microtime</span><span style="color: #007700">(</span><span style="color: #0000BB">true</span><span style="color: #007700">);<br />}&nbsp;while&nbsp;((</span><span style="color: #0000BB">$end&nbsp;</span><span style="color: #007700">-&nbsp;</span><span style="color: #0000BB">$start</span><span style="color: #007700">)&nbsp;&lt;&nbsp;</span><span style="color: #0000BB">$timeTarget</span><span style="color: #007700">);<br /><br />echo&nbsp;</span><span style="color: #DD0000">"Appropriate&nbsp;Cost&nbsp;Found:&nbsp;"&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #0000BB">$cost&nbsp;</span><span style="color: #007700">.&nbsp;</span><span style="color: #DD0000">"\n"</span><span style="color: #007700">;<br /></span><span style="color: #0000BB">?&gt;</span>
</span>
</code></div>
    </div>

    <div class="example-contents"><p>上の例の出力は、
たとえば以下のようになります。</p></div>
    <div class="example-contents screen">
<div class="cdata"><pre>
Appropriate Cost Found: 10
</pre></div>
    </div>
   </div>
  </p>
 </div>

 
 <div class="refsect1 notes" id="refsect1-function.password-hash-notes">
  <h3 class="title">注意</h3>
  <div class="caution"><strong class="caution">警告</strong>
   <p class="para">
    この関数で使うソルトを自前で設定するのはお勧めしません。
    ソルトを省略すれば、安全なソルトをこの関数が自動的に作ってくれます。
   </p>
   <p class="para">
    先述のとおり、PHP 7.0 で <em>salt</em> オプションを指定すると、
    非推奨の警告が発生します。ソルトを手動で設定する仕組みは、将来のリリースで廃止されるかもしれません。
   </p>
  </div>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <p class="para">
    実際にサーバー上でこの関数をテストして、コストパラメータの適切な設定値を調整することをお勧めします。
    対話型のシステムなら、関数の実行時間が 100 ミリ秒くらいに収まるくらいが適切です。
    先ほどの例のスクリプトは、自分のハードウェア上での適切なコストを判断するための助けとなるでしょう。
   </p>
  </p></blockquote>
  <blockquote class="note"><p><strong class="note">注意</strong>: 
   <span class="simpara">
    この関数がサポートするアルゴリズムの更新 (あるいはデフォルトのアルゴリズムの変更)
    は、必ず次の手順にのっとって行われます。
   </span>
   <p class="para">
    <ul class="itemizedlist">
     <li class="listitem">
      <span class="simpara">
       新しく追加されたアルゴリズムがデフォルトになるまでには、
       少なくとも一度は PHP のフルリリースを経ること。
       つまり、たとえば、新しいアルゴリズムが 7.5.5 で追加されたとすると、
       そのアルゴリズムがデフォルトになるのは早くても 7.7 以降ということになります
       (7.6 は、最初のフルリリースだからです)。
       しかし、もし別のアルゴリズムが 7.6.0 で追加されたとすると、
       そのアルゴリズムも 7.7.0 の時点でデフォルトになる資格を得ます。
      </span>
     </li>
     <li class="listitem">
      <span class="simpara">
       デフォルトを変更できるのはフルリリース (7.3.0 や 8.0.0 など)
       のときだけで、リビジョンリリースでは変更できない。
       唯一の例外は、現在のデフォルトにセキュリティ上の致命的な欠陥が発覚した場合の緊急リリースです。
      </span>
     </li>
    </ul>
   </p>
  </p></blockquote>
 </div>


 <div class="refsect1 seealso" id="refsect1-function.password-hash-seealso">
  <h3 class="title">参考</h3>
  <p class="para">
   <ul class="simplelist">
    <li class="member"><span class="function"><a href="function.password-verify.html" class="function" rel="rdfs-seeAlso">password_verify()</a> - パスワードがハッシュにマッチするかどうかを調べる</span></li>
    <li class="member"><span class="function"><a href="function.crypt.html" class="function" rel="rdfs-seeAlso">crypt()</a> - 文字列の一方向のハッシュ化を行う</span></li>
    <li class="member"><a href="https://github.com/ircmaxell/password_compat" class="link external" title="Link : https://github.com/ircmaxell/password_compat">&raquo;&nbsp;ユーザーランドでの実装</a></li>
   </ul>
  </p>
 </div>


</div><div id="usernotes">
 <div class="head">
  <h3 class="title">User Contributed Notes</h3>
 </div>
<div id="allnotes">  <a name="119509""></a>
  <div class="note">
   <strong class="user">darkflib</strong>
   <a href="#119509" class="date">24-Jun-2016 09:22</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Timings:<br />
<br />
Note: 1 and 2 for cost are invalid.<br />
<br />
3&nbsp; -&nbsp; 0.085115432739258ms<br />
4&nbsp; -&nbsp; 1.6319751739502ms<br />
5&nbsp; -&nbsp; 2.9170513153076ms<br />
6&nbsp; -&nbsp; 5.511999130249ms<br />
7&nbsp; -&nbsp; 10.689973831177ms<br />
8&nbsp; -&nbsp; 20.890951156616ms<br />
9&nbsp; -&nbsp; 41.686058044434ms<br />
10&nbsp; -&nbsp; 84.12504196167ms (default)<br />
11&nbsp; -&nbsp; 168.97416114807ms<br />
12&nbsp; -&nbsp; 334.79714393616ms<br />
13&nbsp; -&nbsp; 680.88603019714ms<br />
14&nbsp; -&nbsp; 1342.1139717102ms<br />
15&nbsp; -&nbsp; 2706.4559459686ms<br />
16&nbsp; -&nbsp; 5404.2019844055ms<br />
17&nbsp; -&nbsp; 10615.604162216ms<br />
<br />
For an average site the default of 10 is probably a sane enough value.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118603""></a>
  <div class="note">
   <strong class="user">Lyo Mi</strong>
   <a href="#118603" class="date">07-Jan-2016 03:11</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Please note that password_hash will ***truncate*** the password at the first NULL-byte.<br />
<br />
<a href="http://blog.ircmaxell.com/2015/03/security-issue-combining-bcrypt-with.html" rel="nofollow" target="_blank">http://blog.ircmaxell.com/2015/03/security-issue-combining-bcrypt-with.html</a><br />
<br />
If you use anything as an input that can generate NULL bytes (sha1 with raw as true, or if NULL bytes can naturally end up in people's passwords), you may make your application much less secure than what you might be expecting.<br />
<br />
The password <br />
$a = "\01234567"; <br />
is zero bytes long (an empty password) for bcrypt.<br />
<br />
The workaround, of course, is to make sure you don't ever pass NULL-bytes to password_hash.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="118576""></a>
  <div class="note">
   <strong class="user">anonymous</strong>
   <a href="#118576" class="date">31-Dec-2015 08:13</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Pay close attention to the maximum allowed length of the password parameter!&nbsp; If you exceed the maximum length, it will be truncated without warning.<br />
<br />
If you prepend your own salt/pepper to the password, and that salt/pepper exceeds the maximum length, then this function will truncate the actual password.&nbsp; That means password_verify() will return true with ANY password using the same salt/pepper.<br />
<br />
It might be a good idea to append any salt/pepper to the end of the password instead.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="117884""></a>
  <div class="note">
   <strong class="user">VladimirMozhenkov at yahoo dot com</strong>
   <a href="#117884" class="date">26-Aug-2015 09:04</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
Note that this function can return NULL. It does so if you provide an incorrect constant as an algorythm. I had the following:<br />
<br />
&nbsp;&nbsp;&nbsp; $password = password_hash($password1, PASSWORD_BDCRYPT, array( 'cost' =&gt; 10 ));<br />
<br />
and i couldn't understand why i kept having NULL written in $password; it was a simple fact that the constant was PASSWORD_BCRYPT.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="115629""></a>
  <div class="note">
   <strong class="user">Mike Robinson</strong>
   <a href="#115629" class="date">28-Aug-2014 11:52</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
For passwords, you generally want the hash calculation time to be between 250 and 500 ms (maybe more for administrator accounts). Since calculation time is dependent on the capabilities of the server, using the same cost parameter on two different servers may result in vastly different execution times. Here's a quick little function that will help you determine what cost parameter you should be using for your server to make sure you are within this range (note, I am providing a salt to eliminate any latency caused by creating a pseudorandom salt, but this should not be done when hashing passwords):<br />
<br />
<span class="default">&lt;?php<br />
</span><span class="comment">/**<br />
&nbsp;* @Param int $min_ms Minimum amount of time in milliseconds that it should take<br />
&nbsp;* to calculate the hashes<br />
&nbsp;*/<br />
</span><span class="keyword">function </span><span class="default">getOptimalBcryptCostParameter</span><span class="keyword">(</span><span class="default">$min_ms </span><span class="keyword">= </span><span class="default">250</span><span class="keyword">) {<br />
&nbsp;&nbsp;&nbsp; for (</span><span class="default">$i </span><span class="keyword">= </span><span class="default">4</span><span class="keyword">; </span><span class="default">$i </span><span class="keyword">&lt; </span><span class="default">31</span><span class="keyword">; </span><span class="default">$i</span><span class="keyword">++) {<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$options </span><span class="keyword">= [ </span><span class="string">'cost' </span><span class="keyword">=&gt; </span><span class="default">$i</span><span class="keyword">, </span><span class="string">'salt' </span><span class="keyword">=&gt; </span><span class="string">'usesomesillystringforsalt' </span><span class="keyword">];<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$time_start </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">password_hash</span><span class="keyword">(</span><span class="string">"rasmuslerdorf"</span><span class="keyword">, </span><span class="default">PASSWORD_BCRYPT</span><span class="keyword">, </span><span class="default">$options</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; </span><span class="default">$time_end </span><span class="keyword">= </span><span class="default">microtime</span><span class="keyword">(</span><span class="default">true</span><span class="keyword">);<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; if ((</span><span class="default">$time_end </span><span class="keyword">- </span><span class="default">$time_start</span><span class="keyword">) * </span><span class="default">1000 </span><span class="keyword">&gt; </span><span class="default">$min_ms</span><span class="keyword">) {<br />
&nbsp;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp; return </span><span class="default">$i</span><span class="keyword">;<br />
&nbsp;&nbsp; &nbsp; &nbsp;&nbsp; }<br />
&nbsp;&nbsp;&nbsp; }<br />
}<br />
echo </span><span class="default">getOptimalBcryptCostParameter</span><span class="keyword">(); </span><span class="comment">// prints 12 in my case<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="114410""></a>
  <div class="note">
   <strong class="user">cottton</strong>
   <a href="#114410" class="date">18-Feb-2014 01:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
if you thought<br />
"why is the salt included in the hash and is it save when i store it as it is in my db?"<br />
<br />
Answer i found:<br />
The salt just has to be unique. It not meant to be a secret.<br />
<br />
As mentioned in notes and docu before: let password_hash() take care of the salt.<br />
<br />
With the unique salt you force the attacker to crack the hash.<br />
The hash is unique and cannot be found at rainbow tables.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113490""></a>
  <div class="note">
   <strong class="user">Cloxy</strong>
   <a href="#113490" class="date">18-Oct-2013 06:45</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
You can produce the same hash in php 5.3.7+ with crypt() function:<br />
<br />
<span class="default">&lt;?php<br />
<br />
$salt </span><span class="keyword">= </span><span class="default">mcrypt_create_iv</span><span class="keyword">(</span><span class="default">22</span><span class="keyword">, </span><span class="default">MCRYPT_DEV_URANDOM</span><span class="keyword">);<br />
</span><span class="default">$salt </span><span class="keyword">= </span><span class="default">base64_encode</span><span class="keyword">(</span><span class="default">$salt</span><span class="keyword">);<br />
</span><span class="default">$salt </span><span class="keyword">= </span><span class="default">str_replace</span><span class="keyword">(</span><span class="string">'+'</span><span class="keyword">, </span><span class="string">'.'</span><span class="keyword">, </span><span class="default">$salt</span><span class="keyword">);<br />
</span><span class="default">$hash </span><span class="keyword">= </span><span class="default">crypt</span><span class="keyword">(</span><span class="string">'rasmuslerdorf'</span><span class="keyword">, </span><span class="string">'$2y$10$'</span><span class="keyword">.</span><span class="default">$salt</span><span class="keyword">.</span><span class="string">'$'</span><span class="keyword">);<br />
<br />
echo </span><span class="default">$hash</span><span class="keyword">;<br />
<br />
</span><span class="default">?&gt;</span>
</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="113397""></a>
  <div class="note">
   <strong class="user">nicoSWD</strong>
   <a href="#113397" class="date">06-Oct-2013 12:29</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
I agree with martinstoeckli,<br />
<br />
don't create your own salts unless you really know what you're doing.<br />
<br />
By default, it'll use /dev/urandom to create the salt, which is based on noise from device drivers.<br />
<br />
And on Windows, it uses CryptGenRandom().<br />
<br />
Both have been around for many years, and are considered secure for cryptography (the former probably more than the latter, though).<br />
<br />
Don't try to outsmart these defaults by creating something less secure. Anything that is based on rand(), mt_rand(), uniqid(), or variations of these is *not* good.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="111620""></a>
  <div class="note">
   <strong class="user">martinstoeckli</strong>
   <a href="#111620" class="date">09-Mar-2013 07:36</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
In most cases it is best to omit the salt parameter. Without this parameter, the function will generate a cryptographically safe salt, from the random source of the operating system.</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
  <a name="110872""></a>
  <div class="note">
   <strong class="user">martinstoeckli</strong>
   <a href="#110872" class="date">18-Dec-2012 05:56</a>
   <div class="text">
    <div class="phpcode">
<code><span class="html">
There is a compatibility pack available for PHP versions 5.3.7 and later, so you don't have to wait on version 5.5 for using this function. It comes in form of a single php file:<br />
https://github.com/ircmaxell/password_compat</span>
</code>
    </div>
   </div>
  </div>
 <div class="foot"></div>
</div>
</div>
<hr /><div class="manualnavbar" style="text-align: center;">
 <div class="prev" style="text-align: left; float: left;"><a href="function.password-get-info.html">password_get_info</a></div>
 <div class="next" style="text-align: right; float: right;"><a href="function.password-needs-rehash.html">password_needs_rehash</a></div>
 <div class="up"><a href="ref.password.html">Password Hashing 関数</a></div>
 <div class="home"><a href="index.html">PHP Manual</a></div>
</div></body></html>
